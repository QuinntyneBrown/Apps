@startuml Payment Scheduling Use Case Diagram

!theme plain
left to right direction

actor "User" as User
actor "Payment Gateway" as Gateway
actor "System Scheduler" as Scheduler

rectangle "Payment Scheduling" {
  usecase "Schedule Payment" as UC1
  usecase "Execute Payment" as UC2
  usecase "Cancel Payment" as UC3
  usecase "Modify Payment Schedule" as UC4
  usecase "View Upcoming Payments" as UC5
  usecase "View Payment History" as UC6
  usecase "Retry Failed Payment" as UC7
  usecase "Manage Payment Methods" as UC8
  usecase "Add Payment Method" as UC9
  usecase "Remove Payment Method" as UC10
  usecase "Set Default Payment Method" as UC11
  usecase "View Payment Details" as UC12
  usecase "Download Payment Receipt" as UC13
  usecase "Setup Recurring Payment" as UC14

  usecase "Validate Payment Data" as UC15
  usecase "Process Payment" as UC16
  usecase "Publish Domain Event" as UC17
  usecase "Send Payment Notification" as UC18
  usecase "Auto-Execute Scheduled Payments" as UC19
  usecase "Generate Recurring Payment Instances" as UC20
}

' User interactions
User --> UC1
User --> UC2
User --> UC3
User --> UC4
User --> UC5
User --> UC6
User --> UC7
User --> UC8
User --> UC9
User --> UC10
User --> UC11
User --> UC12
User --> UC13
User --> UC14

' System interactions
Scheduler --> UC19
Scheduler --> UC20

' Gateway interactions
UC16 --> Gateway

' Include relationships
UC1 ..> UC15 : <<include>>
UC1 ..> UC17 : <<include>>
UC2 ..> UC16 : <<include>>
UC2 ..> UC17 : <<include>>
UC3 ..> UC17 : <<include>>
UC7 ..> UC16 : <<include>>
UC19 ..> UC2 : <<include>>

' Extend relationships
UC1 ..> UC14 : <<extend>>
UC1 ..> UC18 : <<extend>>
UC2 ..> UC18 : <<extend>>
UC3 ..> UC18 : <<extend>>
UC2 ..> UC20 : <<extend>>

note right of UC1
  User creates a payment schedule
  for a bill with specified date
  and payment method
end note

note right of UC2
  Execute payment through
  payment gateway and update
  payment status
end note

note right of UC19
  Background job runs hourly
  to execute scheduled payments
  that are due
end note

note right of UC20
  Daily job generates next
  payment instance for
  recurring payments
end note

@enduml
