@startuml Password Account Auditor Sequence

title Security Audit and Breach Detection Flow

actor User
actor "Scheduler" as Scheduler
participant "UI" as UI
participant "Audit\nService" as Audit
participant "Password\nAnalyzer" as PwdAnalyzer
participant "Breach\nMonitor" as BreachMonitor
participant "Notification\nService" as Notif
participant "Database" as DB
participant "HaveIBeenPwned\nAPI" as HIBP

== Run Security Audit ==

User -> UI: Click "Run Audit"
UI -> Audit: PerformSecurityAudit(userId)
Audit -> DB: GetUserAccounts(userId)
DB --> Audit: List<Account>

loop For each account
  Audit -> PwdAnalyzer: AssessPasswordStrength(password)
  PwdAnalyzer --> Audit: StrengthScore, Weaknesses

  alt Password is weak
    Audit -> DB: CreateVulnerability(accountId, "Weak Password", severity)
  end

  alt Password reused
    Audit -> DB: CreateVulnerability(accountId, "Password Reuse", severity)
  end

  alt No 2FA enabled
    Audit -> DB: CreateVulnerability(accountId, "Missing 2FA", severity)
  end

  alt Password age > 90 days
    Audit -> DB: CreateVulnerability(accountId, "Old Password", severity)
  end
end

Audit -> Audit: CalculateSecurityScore(vulnerabilities)
Audit -> DB: SaveAuditResults(auditId, score, vulnerabilities)
Audit --> UI: AuditComplete(score, issuesFound)
UI --> User: Display audit results with score

== Breach Monitoring (Background) ==

Scheduler -> BreachMonitor: CheckForBreaches()
BreachMonitor -> DB: GetActiveAccounts()
DB --> BreachMonitor: List<Account>

loop For each account
  BreachMonitor -> HIBP: CheckBreach(email/username)
  HIBP --> BreachMonitor: BreachData

  alt Breach detected
    BreachMonitor -> DB: CreateBreachRecord(accountId, breachData)
    BreachMonitor -> Notif: SendUrgentAlert(userId, breachDetails)
    Notif -> User: "URGENT: Your account was in a data breach!"
  end
end

== User Responds to Breach ==

User -> UI: View breach notification
UI -> User: Show breach details and recommended actions

User -> UI: Complete breach response checklist
UI -> Audit: RecordBreachResponse(breachId, actions)

User -> UI: Change compromised password
UI -> PwdAnalyzer: AssessPasswordStrength(newPassword)
PwdAnalyzer --> UI: StrengthScore

alt Password is strong
  UI -> DB: UpdatePassword(accountId, newPasswordEncrypted)
  UI -> DB: MarkBreachResolved(breachId)
  UI --> User: "Account secured successfully!"
else Password still weak
  UI --> User: "Please choose a stronger password"
end

@enduml
