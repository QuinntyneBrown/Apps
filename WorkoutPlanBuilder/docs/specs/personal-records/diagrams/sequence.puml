@startuml Personal Records - Sequence Diagram
title Automatic PR Detection After Workout

actor User
participant Frontend
participant API
participant PRService
participant Repository
participant Events
participant Notify

User -> Frontend: Complete workout
Frontend -> API: POST /api/workout-sessions/{id}/complete
API -> Events: WorkoutSessionCompletedEvent
Events -> PRService: CheckAndRecordPRsAsync(sessionId)

PRService -> PRService: Get session with sets
PRService -> PRService: Group sets by exercise

loop For each exercise
    PRService -> PRService: Calculate max weight
    PRService -> Repository: GetCurrentPRAsync(userId, exerciseId, MaxWeight)
    Repository --> PRService: current PR (or null)

    alt New PR
        PRService -> PRService: Create PersonalRecord
        PRService -> Repository: AddAsync(record)
        Repository -> Events: PersonalRecordAchievedEvent
        Events -> Notify: Send celebration notification
        Events -> Frontend: WebSocket: new PR!
        Frontend -> Frontend: Show celebration modal
    end

    PRService -> PRService: Calculate other PR types (reps, volume, 1RM)
    PRService -> PRService: Check and record each type
end

PRService --> API: PRs recorded
API --> Frontend: Session completed
Frontend -> Frontend: Display PR summary

@enduml
