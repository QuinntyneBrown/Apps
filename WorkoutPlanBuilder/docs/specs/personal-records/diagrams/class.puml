@startuml Personal Records - Class Diagram

class PersonalRecord <<Aggregate Root>> {
  - Id : Guid
  - UserId : Guid
  - ExerciseId : Guid
  - Type : RecordType
  - Value : decimal
  - Reps : int?
  - Weight : decimal?
  - AchievedDate : DateTime
  - WorkoutSessionId : Guid
  - Notes : string
  - PreviousValue : decimal?
  --
  + Create(...) : PersonalRecord
}

enum RecordType {
  MaxWeight
  MaxReps
  MaxVolume
  Best1RM
  FastestTime
}

class PersonalRecordService {
  - _sessionRepo : IWorkoutSessionRepository
  - _prRepo : IPersonalRecordRepository
  --
  + CheckAndRecordPRsAsync(sessionId) : Task
  + CalculateBest1RM(sets) : decimal
  - CheckPR(userId, exerciseId, type, value, sessionId) : Task
}

class RecordPersonalRecordCommand {
  + ExerciseId : Guid
  + Type : RecordType
  + Value : decimal
  + Reps : int?
  + Weight : decimal?
  + SessionId : Guid
}

interface IPersonalRecordRepository {
  + GetCurrentPRAsync(userId, exerciseId, type) : Task<PersonalRecord>
  + GetUserRecordsAsync(userId, exerciseId, type) : Task<List<PersonalRecord>>
  + GetRecentPRsAsync(userId, days) : Task<List<PersonalRecord>>
}

PersonalRecord --> RecordType
PersonalRecordService ..> PersonalRecord : manages
RecordPersonalRecordCommand ..> PersonalRecord : creates
IPersonalRecordRepository ..> PersonalRecord : stores

@enduml
