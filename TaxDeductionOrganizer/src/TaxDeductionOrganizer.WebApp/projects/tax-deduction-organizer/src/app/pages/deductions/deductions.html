<div class="deductions">
  <div class="deductions__header">
    <h1 class="deductions__title">Deductions</h1>
    <button mat-raised-button color="primary" (click)="openAddDialog()" class="deductions__add-button">
      <mat-icon>add</mat-icon>
      Add Deduction
    </button>
  </div>

  <mat-card class="deductions__card">
    <mat-card-content>
      <div class="deductions__table-container" *ngIf="deductions$ | async as deductions">
        <table mat-table [dataSource]="deductions" class="deductions__table" *ngIf="deductions.length > 0; else noDeductions">
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef class="deductions__header-cell">Date</th>
            <td mat-cell *matCellDef="let deduction" class="deductions__cell">
              {{ deduction.date | date:'shortDate' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef class="deductions__header-cell">Description</th>
            <td mat-cell *matCellDef="let deduction" class="deductions__cell">
              {{ deduction.description }}
              <div class="deductions__notes" *ngIf="deduction.notes">
                {{ deduction.notes }}
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef class="deductions__header-cell">Category</th>
            <td mat-cell *matCellDef="let deduction" class="deductions__cell">
              <mat-chip class="deductions__category-chip">{{ getCategoryName(deduction.category) }}</mat-chip>
            </td>
          </ng-container>

          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef class="deductions__header-cell">Amount</th>
            <td mat-cell *matCellDef="let deduction" class="deductions__cell deductions__amount">
              {{ deduction.amount | currency }}
            </td>
          </ng-container>

          <ng-container matColumnDef="hasReceipt">
            <th mat-header-cell *matHeaderCellDef class="deductions__header-cell">Receipt</th>
            <td mat-cell *matCellDef="let deduction" class="deductions__cell">
              <mat-icon [class.deductions__icon--success]="deduction.hasReceipt" [class.deductions__icon--muted]="!deduction.hasReceipt">
                {{ deduction.hasReceipt ? 'check_circle' : 'cancel' }}
              </mat-icon>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="deductions__header-cell">Actions</th>
            <td mat-cell *matCellDef="let deduction" class="deductions__cell">
              <div class="deductions__actions">
                <button mat-icon-button (click)="openEditDialog(deduction)" class="deductions__action-button">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="deleteDeduction(deduction.deductionId)" class="deductions__action-button">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="deductions__header-row"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="deductions__row"></tr>
        </table>

        <ng-template #noDeductions>
          <div class="deductions__empty">
            <mat-icon class="deductions__empty-icon">receipt_long</mat-icon>
            <p class="deductions__empty-text">No deductions yet</p>
            <button mat-raised-button color="primary" (click)="openAddDialog()" class="deductions__empty-button">
              Add Your First Deduction
            </button>
          </div>
        </ng-template>
      </div>
    </mat-card-content>
  </mat-card>
</div>
