<div class="list-detail">
  <ng-container *ngIf="viewModel$ | async as vm">
    @if (vm.loading) {
      <div class="list-detail__loading">
        <mat-spinner diameter="40"></mat-spinner>
        <span>Loading list...</span>
      </div>
    } @else if (vm.error || !vm.list) {
      <div class="list-detail__error">
        <mat-icon>error</mat-icon>
        <span>{{ vm.error || 'List not found' }}</span>
        <button mat-raised-button (click)="goBack()">Go Back</button>
      </div>
    } @else {
      <header class="list-detail__header">
        <button mat-icon-button (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <h1 class="list-detail__title">{{ vm.list.name }}</h1>
        <button mat-raised-button color="primary" (click)="openAddItemDialog()">
          <mat-icon>add</mat-icon>
          Add Item
        </button>
      </header>

      <div class="list-detail__progress">
        @if (vm.items.length > 0) {
          <span>
            {{ (vm.items | slice:0:vm.items.length).filter(i => i.isChecked).length }} of {{ vm.items.length }} items completed
          </span>
        }
      </div>

      @if (vm.items.length === 0) {
        <div class="list-detail__empty">
          <mat-icon>shopping_basket</mat-icon>
          <h2>No items yet</h2>
          <p>Add items to your shopping list to get started!</p>
          <button mat-raised-button color="primary" (click)="openAddItemDialog()">
            <mat-icon>add</mat-icon>
            Add First Item
          </button>
        </div>
      } @else {
        <div class="list-detail__items">
          @for (item of vm.items; track item.groceryItemId) {
            <app-item-card
              [item]="item"
              (toggle)="onToggleItem($event)"
              (delete)="onDeleteItem($event)">
            </app-item-card>
          }
        </div>
      }
    }
  </ng-container>
</div>
