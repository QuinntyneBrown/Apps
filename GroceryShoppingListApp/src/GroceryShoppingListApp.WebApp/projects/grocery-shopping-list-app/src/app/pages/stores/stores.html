<div class="stores">
  <header class="stores__header">
    <h1 class="stores__title">Stores</h1>
  </header>

  <mat-card class="stores__form-card">
    <mat-card-header>
      <mat-card-title>Add New Store</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="stores__form">
        <mat-form-field appearance="outline" class="stores__field">
          <mat-label>Store Name</mat-label>
          <input matInput formControlName="name" placeholder="Enter store name">
          @if (form.get('name')?.hasError('required')) {
            <mat-error>Store name is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="stores__field">
          <mat-label>Address (Optional)</mat-label>
          <input matInput formControlName="address" placeholder="Enter address">
        </mat-form-field>

        <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
          <mat-icon>add</mat-icon>
          Add Store
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <ng-container *ngIf="viewModel$ | async as vm">
    @if (vm.loading) {
      <div class="stores__loading">
        <mat-spinner diameter="40"></mat-spinner>
        <span>Loading stores...</span>
      </div>
    } @else if (vm.error) {
      <div class="stores__error">
        <mat-icon>error</mat-icon>
        <span>{{ vm.error }}</span>
      </div>
    } @else if (vm.stores.length === 0) {
      <div class="stores__empty">
        <mat-icon>store</mat-icon>
        <h2>No stores yet</h2>
        <p>Add stores to track where you shop!</p>
      </div>
    } @else {
      <div class="stores__grid">
        @for (store of vm.stores; track store.storeId) {
          <mat-card class="stores__card">
            <mat-card-header>
              <mat-icon mat-card-avatar>store</mat-icon>
              <mat-card-title>{{ store.name }}</mat-card-title>
              @if (store.address) {
                <mat-card-subtitle>{{ store.address }}</mat-card-subtitle>
              }
            </mat-card-header>
            <mat-card-actions align="end">
              <button mat-icon-button color="warn" (click)="onDelete(store)">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-card-actions>
          </mat-card>
        }
      </div>
    }
  </ng-container>
</div>
