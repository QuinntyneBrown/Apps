@startuml Price Tracking - Class Diagram

!define ENTITY_COLOR #E1F5FE
!define VALUE_OBJECT_COLOR #FFF9C4
!define SERVICE_COLOR #C8E6C9
!define EVENT_COLOR #FFCCBC

package "Price Tracking Domain" {
    class PriceRecord <<Entity>> ENTITY_COLOR {
        - priceId: UUID
        - itemName: String
        - normalizedItemName: String
        - userId: UUID
        - price: Money
        - storeName: String
        - purchaseDate: DateTime
        - quantity: Integer
        - unit: String
        - category: String
        + record(itemName, price, store): PriceRecord
        + normalize(): String
    }

    class PriceAlert <<Entity>> ENTITY_COLOR {
        - alertId: UUID
        - userId: UUID
        - itemName: String
        - alertType: AlertType
        - thresholdPercentage: Decimal
        - isActive: Boolean
        + trigger(): void
        + deactivate(): void
    }

    enum AlertType ENTITY_COLOR {
        PRICE_DROP
        PRICE_INCREASE
        DEAL_FOUND
    }

    class PriceStatistics <<Value Object>> VALUE_OBJECT_COLOR {
        - averagePrice: Money
        - lowestPrice: Money
        - highestPrice: Money
        - sampleCount: Integer
        - trend: PriceTrend
        + calculateTrend(): PriceTrend
    }

    enum PriceTrend VALUE_OBJECT_COLOR {
        INCREASING
        DECREASING
        STABLE
    }

    class Deal <<Value Object>> VALUE_OBJECT_COLOR {
        - itemName: String
        - storeName: String
        - regularPrice: Money
        - salePrice: Money
        - savingsPercentage: Decimal
        - validFrom: DateTime
        - validTo: DateTime
        + calculateSavings(): Money
        + isValid(): Boolean
    }

    class StorePrice <<Value Object>> VALUE_OBJECT_COLOR {
        - storeName: String
        - price: Money
        - lastUpdated: DateTime
        - trend: PriceTrend
        + compare(other): Integer
    }
}

package "Services" {
    class PriceTrackingService <<Service>> SERVICE_COLOR {
        - priceRepository: IPriceRepository
        - alertRepository: IAlertRepository
        - analyticsEngine: IAnalyticsEngine
        - eventPublisher: IEventPublisher
        + recordPrice(priceData): void
        + getPriceHistory(itemName, timeRange): List<PriceRecord>
        + comparePrices(itemName): List<StorePrice>
        + detectPriceChanges(): void
        + identifyDeals(): List<Deal>
        + calculateSavings(userId): Decimal
    }

    interface IPriceRepository {
        + save(record): void
        + findByItem(itemName): List<PriceRecord>
        + findByStore(storeName): List<PriceRecord>
        + getAverages(): Map
    }

    interface IAlertRepository {
        + save(alert): void
        + findActive(): List<PriceAlert>
        + findByUser(userId): List<PriceAlert>
    }

    interface IAnalyticsEngine {
        + calculateStatistics(records): PriceStatistics
        + detectTrend(records): PriceTrend
        + identifyDeals(records): List<Deal>
        + predictPrices(records): Decimal
    }
}

package "Domain Events" {
    class ItemPriceRecorded EVENT_COLOR {
        - priceId: UUID
        - itemName: String
        - price: Decimal
        - storeName: String
    }

    class PriceIncreaseDetected EVENT_COLOR {
        - itemName: String
        - previousPrice: Decimal
        - currentPrice: Decimal
        - increasePercentage: Decimal
    }

    class DealIdentified EVENT_COLOR {
        - itemName: String
        - storeName: String
        - salePrice: Decimal
        - savingsPercentage: Decimal
    }

    class BestPriceStoreIdentified EVENT_COLOR {
        - itemName: String
        - bestStoreName: String
        - bestPrice: Decimal
    }
}

' Relationships
PriceRecord -- AlertType
PriceAlert -- AlertType
PriceStatistics -- PriceTrend
StorePrice -- PriceTrend

PriceTrackingService --> IPriceRepository
PriceTrackingService --> IAlertRepository
PriceTrackingService --> IAnalyticsEngine
PriceTrackingService --> PriceRecord
PriceTrackingService --> Deal

@enduml
