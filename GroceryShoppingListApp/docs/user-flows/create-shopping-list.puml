@startuml
title Create Shopping List User Flow

actor User
participant "ListDashboard\nComponent" as Dashboard
participant "CreateListModal\nComponent" as Modal
participant "Redux Store" as Redux
participant "API\n/api/lists" as API
database "Database" as DB

User -> Dashboard: Click "New List" button
activate Dashboard
Dashboard -> Modal: Open modal (isOpen=true)
activate Modal

Modal --> User: Display create list form

User -> Modal: Enter list name\n(e.g., "Weekly Groceries")
User -> Modal: Add tags (optional)\n(e.g., "weekly", "groceries")
User -> Modal: Mark as recurring (optional)\n(e.g., "weekly")
User -> Modal: Click "Create" button

Modal -> Modal: Validate form\n- Name required (1-255 chars)\n- Show warning if no tags

alt Validation passes
    Modal -> Redux: Dispatch createList(listData)
    activate Redux

    Redux --> Modal: Optimistic update\n(show as creating)
    Modal --> User: Show loading indicator

    Redux -> API: POST /api/lists\n{\n  name, tags,\n  isRecurring, pattern\n}
    activate API

    API -> DB: INSERT INTO shopping_lists\n(list_id, name, owner_id,\ntags, status, created_at)
    activate DB
    DB --> API: List created
    deactivate DB

    API --> Redux: 201 Created\n{ listId, name, ... }
    deactivate API

    Redux -> Redux: Update store:\n- Add list to byId\n- Add listId to allIds\n- Set status: 'active'

    Redux --> Modal: Success
    deactivate Redux

    Modal -> Modal: Close modal
    Modal --> Dashboard: List created event
    deactivate Modal

    Dashboard -> Dashboard: Refresh list view
    Dashboard --> User: Show success notification\n"List created successfully"
    Dashboard --> User: Display new list in\nactive lists view

else Validation fails
    Modal --> User: Show validation errors\n(inline field feedback)
end

deactivate Dashboard

@enduml
