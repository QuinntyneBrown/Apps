@startuml Budget Management - Sequence Diagram

title Set Budget and Track Spending Flow

actor "User" as user
participant "Frontend" as frontend
participant "API" as api
participant "Budget\nService" as service
participant "Repository" as repo
participant "Events" as events

user -> frontend : Set budget $150
frontend -> api : POST /api/budgets\n{listId, budgetAmount: 150}
api -> service : setBudget(listId, 150)
service -> repo : save(budget)
service -> events : publish(ShoppingBudgetSet)
service --> api : Success
api --> frontend : 201 Created
frontend -> user : Budget set confirmation

== Item Purchased - Update Spending ==

user -> frontend : Purchase item $45.99
frontend -> api : Mark item purchased
api -> service : updateSpending(listId, 45.99)
service -> repo : getBudget(listId)
repo --> service : Budget (budgeted: 150, spent: 45.99)

alt Threshold reached (>80%)
    service -> events : publish(BudgetThresholdReached)
    events -> user : Send alert notification
end

service -> repo : updateActualTotal(145.99)
service -> events : publish(ActualSpendingRecorded)
service --> api : Success
api --> frontend : Updated budget status
frontend -> user : Show budget progress

@enduml
