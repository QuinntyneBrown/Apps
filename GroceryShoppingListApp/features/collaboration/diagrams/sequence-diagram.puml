@startuml Collaboration - Sequence Diagram

title Real-time Collaboration Flow

actor "User A" as userA
participant "Frontend A" as frontendA
participant "WebSocket\nServer" as ws
participant "Collaboration\nService" as service
participant "Repository" as repo
participant "Frontend B" as frontendB
actor "User B" as userB

== Establish Connection ==

userA -> frontendA : Open shared list
frontendA -> ws : Connect /ws/lists/{listId}
ws -> service : registerUser(listId, userA)
service -> frontendB : broadcast(user.joined)
frontendB -> userB : Show "Alice joined"

== Make Item Suggestion ==

userA -> frontendA : Suggest "Apples"
frontendA -> service : makeSuggestion(itemData)
service -> repo : saveSuggestion(suggestion)
repo --> service : Saved

service -> ws : broadcast(suggestion.created)
ws -> frontendB : push(suggestion.created)
frontendB -> userB : Show notification:\n"Alice suggested: Apples"

== Approve Suggestion (Real-time) ==

userB -> frontendB : Approve suggestion
frontendB -> service : approveSuggestion(suggestionId)
service -> repo : updateSuggestion(approved)
service -> repo : createItem(fromSuggestion)
repo --> service : Item created

service -> ws : broadcast(item.added)
ws -> frontendA : push(item.added)
ws -> frontendB : push(item.added)

frontendA -> frontendA : Add item to local state
frontendB -> frontendB : Add item to local state

frontendA -> userA : Show "Bob approved:\nApples added to list"
frontendB -> userB : Show "Apples added"

== Purchase Item (Real-time Sync) ==

userA -> frontendA : Mark "Apples" purchased
frontendA -> frontendA : Optimistic update
frontendA -> service : markPurchased(itemId)
service -> repo : updateItem(purchased)

service -> ws : broadcast(item.purchased)
ws -> frontendB : push(item.purchased)

frontendB -> frontendB : Update item status
frontendB -> userB : Show "Alice purchased Apples"

@enduml
