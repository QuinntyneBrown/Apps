<div class="project-detail">
  @if (project$ | async; as project) {
    <div class="project-detail__header">
      <button mat-icon-button (click)="goBack()" class="project-detail__back">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="project-detail__header-content">
        <h1 class="project-detail__title">{{ project.name }}</h1>
        <mat-chip [color]="getStatusColor(project.status)" highlighted>
          {{ getStatusLabel(project.status) }}
        </mat-chip>
      </div>
    </div>

    <mat-card class="project-detail__info">
      <mat-card-header>
        <mat-card-title>Project Information</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="project-detail__info-grid">
          <div class="project-detail__info-item">
            <strong>Description:</strong>
            <p>{{ project.description || 'No description' }}</p>
          </div>
          @if (project.startDate) {
            <div class="project-detail__info-item">
              <strong>Start Date:</strong>
              <p>{{ project.startDate | date }}</p>
            </div>
          }
          @if (project.endDate) {
            <div class="project-detail__info-item">
              <strong>End Date:</strong>
              <p>{{ project.endDate | date }}</p>
            </div>
          }
          @if (project.estimatedCost) {
            <div class="project-detail__info-item">
              <strong>Estimated Cost:</strong>
              <p>{{ project.estimatedCost | currency }}</p>
            </div>
          }
          @if (project.actualCost) {
            <div class="project-detail__info-item">
              <strong>Actual Cost:</strong>
              <p>{{ project.actualCost | currency }}</p>
            </div>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <mat-tab-group class="project-detail__tabs">
      <mat-tab label="Budgets">
        <div class="project-detail__tab-content">
          @if ((budgets$ | async)?.length) {
            <table mat-table [dataSource]="budgets$ | async" class="project-detail__table">
              <ng-container matColumnDef="category">
                <th mat-header-cell *matHeaderCellDef>Category</th>
                <td mat-cell *matCellDef="let budget">{{ budget.category }}</td>
              </ng-container>

              <ng-container matColumnDef="allocatedAmount">
                <th mat-header-cell *matHeaderCellDef>Allocated</th>
                <td mat-cell *matCellDef="let budget">{{ budget.allocatedAmount | currency }}</td>
              </ng-container>

              <ng-container matColumnDef="spentAmount">
                <th mat-header-cell *matHeaderCellDef>Spent</th>
                <td mat-cell *matCellDef="let budget">{{ (budget.spentAmount || 0) | currency }}</td>
              </ng-container>

              <ng-container matColumnDef="remaining">
                <th mat-header-cell *matHeaderCellDef>Remaining</th>
                <td mat-cell *matCellDef="let budget">
                  {{ calculateRemaining(budget.allocatedAmount, budget.spentAmount) | currency }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="budgetColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: budgetColumns;"></tr>
            </table>
          } @else {
            <p class="project-detail__empty">No budgets found for this project.</p>
          }
        </div>
      </mat-tab>

      <mat-tab label="Materials">
        <div class="project-detail__tab-content">
          @if ((materials$ | async)?.length) {
            <table mat-table [dataSource]="materials$ | async" class="project-detail__table">
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let material">{{ material.name }}</td>
              </ng-container>

              <ng-container matColumnDef="quantity">
                <th mat-header-cell *matHeaderCellDef>Quantity</th>
                <td mat-cell *matCellDef="let material">{{ material.quantity }}</td>
              </ng-container>

              <ng-container matColumnDef="unit">
                <th mat-header-cell *matHeaderCellDef>Unit</th>
                <td mat-cell *matCellDef="let material">{{ material.unit || '-' }}</td>
              </ng-container>

              <ng-container matColumnDef="unitCost">
                <th mat-header-cell *matHeaderCellDef>Unit Cost</th>
                <td mat-cell *matCellDef="let material">{{ material.unitCost ? (material.unitCost | currency) : '-' }}</td>
              </ng-container>

              <ng-container matColumnDef="totalCost">
                <th mat-header-cell *matHeaderCellDef>Total Cost</th>
                <td mat-cell *matCellDef="let material">{{ material.totalCost ? (material.totalCost | currency) : '-' }}</td>
              </ng-container>

              <ng-container matColumnDef="supplier">
                <th mat-header-cell *matHeaderCellDef>Supplier</th>
                <td mat-cell *matCellDef="let material">{{ material.supplier || '-' }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="materialColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: materialColumns;"></tr>
            </table>
          } @else {
            <p class="project-detail__empty">No materials found for this project.</p>
          }
        </div>
      </mat-tab>

      <mat-tab label="Contractors">
        <div class="project-detail__tab-content">
          @if ((contractors$ | async)?.length) {
            <table mat-table [dataSource]="contractors$ | async" class="project-detail__table">
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let contractor">{{ contractor.name }}</td>
              </ng-container>

              <ng-container matColumnDef="trade">
                <th mat-header-cell *matHeaderCellDef>Trade</th>
                <td mat-cell *matCellDef="let contractor">{{ contractor.trade || '-' }}</td>
              </ng-container>

              <ng-container matColumnDef="phoneNumber">
                <th mat-header-cell *matHeaderCellDef>Phone</th>
                <td mat-cell *matCellDef="let contractor">{{ contractor.phoneNumber || '-' }}</td>
              </ng-container>

              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef>Email</th>
                <td mat-cell *matCellDef="let contractor">{{ contractor.email || '-' }}</td>
              </ng-container>

              <ng-container matColumnDef="rating">
                <th mat-header-cell *matHeaderCellDef>Rating</th>
                <td mat-cell *matCellDef="let contractor">
                  {{ contractor.rating ? contractor.rating + '/5' : '-' }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="contractorColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: contractorColumns;"></tr>
            </table>
          } @else {
            <p class="project-detail__empty">No contractors found for this project.</p>
          }
        </div>
      </mat-tab>
    </mat-tab-group>
  }
</div>
