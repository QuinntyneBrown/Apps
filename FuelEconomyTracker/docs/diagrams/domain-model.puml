@startuml Fuel Economy Tracker - Domain Model

skinparam classAttributeIconSize 0
skinparam backgroundColor #FEFEFE
skinparam defaultFontName Arial

title Fuel Economy Tracker - Domain Model

abstract class AggregateRoot {
    # List<DomainEvent> domainEvents
    + void ClearEvents()
    # void RaiseDomainEvent(event)
}

class User {
    + Guid Id
    + string Email
    + string Name
    + UserPreferences Preferences
    + List<Vehicle> Vehicles
}

class Vehicle << AggregateRoot >> {
    + Guid Id
    + Guid UserId
    + string Make
    + string Model
    + int Year
    + decimal TankCapacity
    + decimal EPACity
    + decimal EPAHighway
    + decimal EPACombined
    + FuelType FuelType
    + VehicleStatus Status
    --
    + void AddFuelPurchase()
    + void CalculateEconomy()
}

class FuelPurchase << AggregateRoot >> {
    + Guid Id
    + Guid VehicleId
    + Guid UserId
    + DateTime PurchaseDate
    + decimal Gallons
    + decimal CostPerGallon
    + decimal TotalCost
    + int OdometerReading
    + FuelGrade FuelGrade
    + bool IsPartialFill
    + decimal? CalculatedMPG
    + int? MilesSinceLastFill
    --
    + void RecordPurchase()
    + void CalculateMPG(previousFill)
}

class FuelStation << Entity >> {
    + Guid Id
    + string Name
    + Address Location
    + GeoCoordinates Coordinates
    + List<FuelStationRating> Ratings
    + decimal AverageRating
    --
    + void AddRating(rating)
}

class Trip << AggregateRoot >> {
    + Guid Id
    + Guid VehicleId
    + DateTime StartTime
    + DateTime? EndTime
    + int StartingOdometer
    + int? EndingOdometer
    + int? MilesDriven
    + TripPurpose Purpose
    + WeatherConditions Weather
    + DrivingConditions Conditions
    + decimal? EstimatedMPG
    + TripStatus Status
    --
    + void Start()
    + void Complete()
}

class EconomyCalculation << Entity >> {
    + Guid Id
    + Guid VehicleId
    + Guid FuelPurchaseId
    + decimal MPG
    + int MilesDriven
    + decimal GallonsUsed
    + DateTime CalculationDate
    + TripType TripType
    + WeatherConditions Weather
    --
    + void Calculate()
}

class RunningAverage << Entity >> {
    + Guid Id
    + Guid VehicleId
    + decimal CurrentAverage30Day
    + decimal CurrentAverage90Day
    + decimal CurrentAverageLifetime
    + decimal PreviousAverage
    + TrendDirection Trend
    + DateTime LastUpdated
    --
    + void Update(newCalculation)
}

class FuelBudget << AggregateRoot >> {
    + Guid Id
    + Guid VehicleId
    + Guid UserId
    + decimal BudgetAmount
    + BudgetPeriod Period
    + DateTime StartDate
    + DateTime EndDate
    + decimal CurrentSpending
    + decimal ThresholdPercentage
    + BudgetStatus Status
    --
    + void SetBudget()
    + void CheckThreshold()
    + void RecordSpending(amount)
}

class MaintenanceEvent << Entity >> {
    + Guid Id
    + Guid VehicleId
    + string ServiceType
    + DateTime ServiceDate
    + int OdometerReading
    + decimal Cost
    + decimal? MPGBefore
    + decimal? MPGAfter
    + decimal? ImprovementPercentage
    --
    + void CalculateImpact()
}

class Alert << Entity >> {
    + Guid Id
    + Guid UserId
    + AlertType Type
    + string Message
    + AlertSeverity Severity
    + DateTime CreatedAt
    + bool IsRead
    + Dictionary Data
}

class EcoDrivingGoal << AggregateRoot >> {
    + Guid Id
    + Guid VehicleId
    + decimal TargetMPG
    + decimal CurrentBaseline
    + DateTime Deadline
    + decimal Progress
    + GoalStatus Status
    --
    + void SetGoal()
    + void UpdateProgress()
    + void CheckAchievement()
}

' Value Objects
class Address << ValueObject >> {
    + string Street
    + string City
    + string State
    + string ZipCode
}

class GeoCoordinates << ValueObject >> {
    + decimal Latitude
    + decimal Longitude
}

class WeatherConditions << ValueObject >> {
    + decimal Temperature
    + string Conditions
    + int WindSpeed
    + string Precipitation
}

' Enumerations
enum FuelGrade {
    Regular
    Premium
    Diesel
    E85
}

enum TripPurpose {
    Commute
    Business
    Leisure
    Other
}

enum TripStatus {
    InProgress
    Completed
    Cancelled
}

enum AlertType {
    FuelPriceSpike
    LowFuel
    BudgetThreshold
    MPGDecline
    MaintenanceDue
    MilestoneAchieved
}

enum BudgetPeriod {
    Weekly
    Monthly
    Quarterly
    Annual
}

' Relationships
AggregateRoot <|-- Vehicle
AggregateRoot <|-- FuelPurchase
AggregateRoot <|-- Trip
AggregateRoot <|-- FuelBudget
AggregateRoot <|-- EcoDrivingGoal

User "1" *-- "many" Vehicle
Vehicle "1" *-- "many" FuelPurchase
Vehicle "1" *-- "many" Trip
Vehicle "1" *-- "many" EconomyCalculation
Vehicle "1" *-- "0..1" RunningAverage
Vehicle "1" *-- "many" MaintenanceEvent
User "1" *-- "many" FuelBudget
User "1" *-- "many" Alert

FuelPurchase "1" --> "0..1" FuelStation : purchased at
FuelPurchase "1" --> "0..1" EconomyCalculation : generates
Trip --> WeatherConditions : has
FuelStation --> GeoCoordinates : located at
FuelStation --> Address : has

@enduml
