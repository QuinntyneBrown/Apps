@startuml Vaccination Management Class Diagram

' Styling
skinparam classAttributeIconSize 0
skinparam class {
    BackgroundColor WhiteSmoke
    BorderColor Black
    ArrowColor Black
}

' Entities
class Vaccination {
    - VaccinationId : Guid <<PK>>
    - PetId : Guid <<FK>>
    - VaccineName : string
    - VaccineType : VaccineType
    - AdministeredDate : DateTime
    - AdministeredBy : string
    - BatchNumber : string
    - ExpirationDate : DateTime
    - NextDueDate : DateTime
    - AdministrationSite : string
    - Dosage : string
    - AdverseReactions : string
    - CertificateNumber : string
    - Notes : string
    - CreatedDate : DateTime
    - ModifiedDate : DateTime
    - IsActive : bool
    --
    + Create() : Vaccination
    + Update() : void
    + Delete() : void
    + Validate() : ValidationResult
    + RaiseVaccinationAdministeredEvent() : void
}

class VaccinationSchedule {
    - ScheduleId : Guid <<PK>>
    - PetId : Guid <<FK>>
    - VaccineName : string
    - DueDate : DateTime
    - ReminderDate : DateTime
    - IsCompleted : bool
    - CompletedVaccinationId : Guid?
    - Priority : Priority
    - CreatedDate : DateTime
    - ModifiedDate : DateTime
    --
    + Create() : VaccinationSchedule
    + MarkComplete(vaccinationId : Guid) : void
    + UpdatePriority() : void
    + IsOverdue() : bool
    + DaysUntilDue() : int
    + DaysOverdue() : int
    + RaiseDueEvent() : void
    + RaiseOverdueEvent() : void
}

class VaccinationTemplate {
    - TemplateId : Guid <<PK>>
    - VaccineName : string
    - Species : Species
    - FirstDoseAgeWeeks : int
    - BoosterIntervalMonths : int
    - IsCore : bool
    - Description : string
    - IsActive : bool
    --
    + Create() : VaccinationTemplate
    + Update() : void
    + Activate() : void
    + Deactivate() : void
    + GenerateSchedule(birthDate : DateTime) : VaccinationSchedule[]
}

class Pet {
    - PetId : Guid <<PK>>
    - OwnerId : Guid <<FK>>
    - Name : string
    - Species : Species
    - Breed : string
    - BirthDate : DateTime
    --
    + GetVaccinations() : List<Vaccination>
    + GetVaccinationSchedule() : List<VaccinationSchedule>
    + IsVaccinationCurrent() : bool
}

class Owner {
    - OwnerId : Guid <<PK>>
    - Name : string
    - Email : string
    - Phone : string
    - NotificationPreferences : NotificationPreferences
    --
    + GetPets() : List<Pet>
    + GetOverdueVaccinations() : List<VaccinationSchedule>
}

' Value Objects and Enums
enum VaccineType {
    Core
    NonCore
    Lifestyle
}

enum Priority {
    Critical
    High
    Medium
    Low
}

enum Species {
    Dog
    Cat
    Bird
    Rabbit
    Ferret
    Other
}

class NotificationPreferences {
    - EnableEmail : bool
    - EnableSMS : bool
    - EnablePush : bool
    - QuietHoursStart : TimeSpan
    - QuietHoursEnd : TimeSpan
    - ReminderDaysBefore : int[]
}

' Domain Events
class VaccinationAdministered <<Domain Event>> {
    + VaccinationId : Guid
    + PetId : Guid
    + PetName : string
    + OwnerId : Guid
    + VaccineName : string
    + AdministeredDate : DateTime
    + NextDueDate : DateTime
    + AdministeredBy : string
    + CertificateNumber : string
    + EventTimestamp : DateTime
}

class VaccinationDue <<Domain Event>> {
    + ScheduleId : Guid
    + PetId : Guid
    + PetName : string
    + OwnerId : Guid
    + VaccineName : string
    + DueDate : DateTime
    + DaysUntilDue : int
    + Priority : Priority
    + LastAdministeredDate : DateTime?
    + EventTimestamp : DateTime
}

class VaccinationOverdue <<Domain Event>> {
    + ScheduleId : Guid
    + PetId : Guid
    + PetName : string
    + OwnerId : Guid
    + VaccineName : string
    + DueDate : DateTime
    + DaysOverdue : int
    + IsLegallyRequired : bool
    + Priority : Priority
    + LastAdministeredDate : DateTime?
    + EventTimestamp : DateTime
}

' Services
class VaccinationService {
    + RecordVaccination(vaccination : Vaccination) : Result
    + UpdateVaccination(id : Guid, updates : VaccinationUpdate) : Result
    + DeleteVaccination(id : Guid) : Result
    + GetVaccinationHistory(petId : Guid) : List<Vaccination>
    + GenerateVaccinationReport(petId : Guid) : VaccinationReport
}

class ScheduleService {
    + CreateSchedule(schedule : VaccinationSchedule) : Result
    + GenerateScheduleFromTemplate(petId : Guid, species : Species) : List<VaccinationSchedule>
    + MarkComplete(scheduleId : Guid, vaccinationId : Guid) : Result
    + GetDueVaccinations(days : int) : List<VaccinationSchedule>
    + GetOverdueVaccinations() : List<VaccinationSchedule>
    + CheckDueVaccinations() : void
    + CheckOverdueVaccinations() : void
}

class NotificationService {
    + SendVaccinationReminder(schedule : VaccinationSchedule, owner : Owner) : void
    + SendOverdueAlert(schedule : VaccinationSchedule, owner : Owner) : void
    + SendVaccinationConfirmation(vaccination : Vaccination, owner : Owner) : void
}

class CertificateService {
    + GenerateCertificate(petId : Guid, vaccinationIds : List<Guid>) : Certificate
    + GenerateQRCode(certificateId : Guid) : QRCode
    + VerifyCertificate(certificateId : Guid) : CertificateVerification
}

' Relationships

' Entity Relationships
Owner "1" -- "0..*" Pet : owns
Pet "1" -- "0..*" Vaccination : has
Pet "1" -- "0..*" VaccinationSchedule : has scheduled
VaccinationSchedule "0..1" -- "0..1" Vaccination : completed by
VaccinationTemplate "1" -- "0..*" VaccinationSchedule : generates

' Enum Relationships
Vaccination --> VaccineType : uses
VaccinationSchedule --> Priority : has
VaccinationTemplate --> Species : for
Pet --> Species : is

' Value Object Relationships
Owner --> NotificationPreferences : has

' Domain Event Relationships
Vaccination ..> VaccinationAdministered : raises
VaccinationSchedule ..> VaccinationDue : raises
VaccinationSchedule ..> VaccinationOverdue : raises

' Service Dependencies
VaccinationService --> Vaccination : manages
VaccinationService ..> VaccinationAdministered : publishes
ScheduleService --> VaccinationSchedule : manages
ScheduleService --> VaccinationTemplate : uses
ScheduleService ..> VaccinationDue : publishes
ScheduleService ..> VaccinationOverdue : publishes
NotificationService ..> VaccinationDue : handles
NotificationService ..> VaccinationOverdue : handles
NotificationService ..> VaccinationAdministered : handles
NotificationService --> Owner : notifies
CertificateService --> Vaccination : uses

' Notes
note right of Vaccination
  Core entity representing a
  completed vaccination record.
  Triggers VaccinationAdministered
  event on creation.
end note

note right of VaccinationSchedule
  Manages upcoming vaccinations.
  Automatically updates priority
  based on due date proximity.
  Raises VaccinationDue and
  VaccinationOverdue events.
end note

note right of VaccinationTemplate
  Provides vaccination schedules
  based on pet species and age.
  Used to auto-generate schedules
  for new pets.
end note

note bottom of ScheduleService
  Background job checks for due/overdue
  vaccinations daily and raises events.
end note

@enduml
