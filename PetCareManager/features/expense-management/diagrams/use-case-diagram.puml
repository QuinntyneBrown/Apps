@startuml Expense Management Use Case Diagram

!define ACTOR_COLOR #4CAF50
!define USECASE_COLOR #2196F3
!define SYSTEM_COLOR #E1F5FE

skinparam actor {
    BackgroundColor ACTOR_COLOR
    BorderColor #2E7D32
}

skinparam usecase {
    BackgroundColor USECASE_COLOR
    BorderColor #1565C0
    FontColor #FFFFFF
}

skinparam rectangle {
    BackgroundColor SYSTEM_COLOR
    BorderColor #0277BD
    FontSize 14
    FontStyle bold
}

left to right direction

actor "Pet Owner" as owner
actor "System Administrator" as admin
actor "Insurance Provider\nAPI" as insurance
actor "Background Job" as job

rectangle "Expense Management System" {

    ' Expense Management Use Cases
    package "Expense Tracking" {
        usecase "Record Expense" as UC1
        usecase "Edit Expense" as UC2
        usecase "Delete Expense" as UC3
        usecase "View Expense History" as UC4
        usecase "Attach Receipt" as UC5
        usecase "Categorize Expense" as UC6
        usecase "Tag Expense" as UC7
        usecase "Search Expenses" as UC8
        usecase "Filter Expenses" as UC9
        usecase "Sort Expenses" as UC10
    }

    ' Insurance Claim Use Cases
    package "Insurance Claims" {
        usecase "Create Claim" as UC11
        usecase "Add Expense to Claim" as UC12
        usecase "Remove Expense from Claim" as UC13
        usecase "Upload Supporting Documents" as UC14
        usecase "Submit Claim" as UC15
        usecase "Track Claim Status" as UC16
        usecase "View Claim Details" as UC17
        usecase "Settle Claim" as UC18
        usecase "Cancel Claim" as UC19
    }

    ' Analytics & Reporting Use Cases
    package "Analytics & Reporting" {
        usecase "View Expense Dashboard" as UC20
        usecase "View Spending Trends" as UC21
        usecase "View Category Breakdown" as UC22
        usecase "Compare Multi-Pet Expenses" as UC23
        usecase "Export Expense Report" as UC24
        usecase "View Claim Analytics" as UC25
        usecase "Calculate Out-of-Pocket Cost" as UC26
    }

    ' System Use Cases
    package "System Operations" {
        usecase "Validate Expense Data" as UC27
        usecase "Validate Claim Eligibility" as UC28
        usecase "Publish Domain Events" as UC29
        usecase "Send Notifications" as UC30
        usecase "Store Receipt Files" as UC31
        usecase "Process OCR for Receipts" as UC32
        usecase "Sync with Insurance Provider" as UC33
        usecase "Create Recurring Expenses" as UC34
        usecase "Archive Old Records" as UC35
    }
}

' Pet Owner relationships with Expense Tracking
owner --> UC1
owner --> UC2
owner --> UC3
owner --> UC4
owner --> UC5
owner --> UC6
owner --> UC7
owner --> UC8
owner --> UC9
owner --> UC10

' Pet Owner relationships with Insurance Claims
owner --> UC11
owner --> UC12
owner --> UC13
owner --> UC14
owner --> UC15
owner --> UC16
owner --> UC17
owner --> UC19

' Pet Owner relationships with Analytics
owner --> UC20
owner --> UC21
owner --> UC22
owner --> UC23
owner --> UC24
owner --> UC25
owner --> UC26

' Administrator relationships
admin --> UC18
admin --> UC35

' Insurance Provider API relationships
insurance --> UC33
UC15 ..> UC33 : <<triggers>>
UC18 ..> UC33 : <<triggers>>

' Background Job relationships
job --> UC34
job --> UC35
job --> UC32

' Include relationships
UC1 ..> UC27 : <<include>>
UC1 ..> UC29 : <<include>>
UC1 ..> UC31 : <<include>>

UC2 ..> UC27 : <<include>>
UC2 ..> UC29 : <<include>>

UC3 ..> UC29 : <<include>>

UC5 ..> UC31 : <<include>>
UC5 ..> UC32 : <<extend>>

UC11 ..> UC28 : <<include>>
UC11 ..> UC29 : <<include>>

UC12 ..> UC28 : <<include>>

UC15 ..> UC29 : <<include>>
UC15 ..> UC30 : <<include>>

UC18 ..> UC29 : <<include>>
UC18 ..> UC30 : <<include>>

' Extend relationships
UC1 ..> UC5 : <<extend>>
UC1 ..> UC6 : <<extend>>
UC1 ..> UC7 : <<extend>>

UC4 ..> UC8 : <<extend>>
UC4 ..> UC9 : <<extend>>
UC4 ..> UC10 : <<extend>>

UC11 ..> UC14 : <<extend>>

UC24 ..> UC21 : <<extend>>
UC24 ..> UC22 : <<extend>>

' Notes
note right of UC1
  Records a new pet expense
  with category, amount, vendor,
  and optional receipt
end note

note right of UC11
  Creates an insurance claim
  by selecting one or more
  insurable expenses
end note

note right of UC15
  Submits claim to insurance
  provider. Requires supporting
  documents to be attached.
end note

note right of UC18
  Admin settles claim with
  approved/denied amounts.
  Triggers reimbursement updates.
end note

note bottom of UC29
  Publishes domain events:
  - PetExpenseRecorded
  - InsuranceClaimFiled
  - InsuranceClaimSettled
end note

note right of UC28
  Validates if expenses are
  eligible for insurance claim:
  - Must be marked insurable
  - Must not be already claimed
  - Must belong to same pet
end note

note right of UC32
  Optionally uses OCR to
  extract expense details
  from receipt images
end note

note right of UC34
  Automatically creates recurring
  expenses (e.g., monthly food,
  annual checkups) based on
  user-defined schedules
end note

@enduml
