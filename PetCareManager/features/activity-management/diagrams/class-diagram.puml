@startuml Activity Management Class Diagram

!define AGGREGATE_ROOT_COLOR #FFE4B5
!define ENTITY_COLOR #E0FFFF
!define VALUE_OBJECT_COLOR #F0E68C
!define DOMAIN_EVENT_COLOR #FFB6C1
!define SERVICE_COLOR #D3D3D3

skinparam classAttributeIconSize 0
skinparam backgroundColor white
skinparam shadowing false

title Activity Management - Domain Model

' Aggregate Roots
class ExerciseSession <<Aggregate Root>> AGGREGATE_ROOT_COLOR {
  +SessionId: Guid
  +PetId: Guid
  +ActivityType: string
  +DurationMinutes: int
  +DistanceMeters: decimal?
  +IntensityLevel: IntensityLevel
  +CaloriesBurned: decimal?
  +StartTime: DateTime
  +EndTime: DateTime
  +Notes: string?
  +LocationName: string?
  +OwnerId: Guid
  +CreatedAt: DateTime
  +UpdatedAt: DateTime?
  --
  +CalculateCalories(): decimal
  +Validate(): ValidationResult
  +UpdateDetails(data): void
  +MarkAsDeleted(): void
}

class ExerciseGoal <<Aggregate Root>> AGGREGATE_ROOT_COLOR {
  +GoalId: Guid
  +PetId: Guid
  +GoalType: GoalType
  +TargetDurationMinutes: int?
  +TargetDistance: decimal?
  +TargetCalories: decimal?
  +TargetSessionsCount: int?
  +StartDate: DateTime
  +EndDate: DateTime?
  +IsRecurring: bool
  +Status: GoalStatus
  +SetBy: Guid
  +CreatedAt: DateTime
  +UpdatedAt: DateTime?
  --
  +CalculateProgress(): GoalProgress
  +UpdateProgress(sessions): void
  +MarkAsCompleted(): void
  +MarkAsFailed(): void
  +Cancel(): void
  +IsActive(): bool
  +IsExpired(): bool
}

class BehaviorIncident <<Aggregate Root>> AGGREGATE_ROOT_COLOR {
  +IncidentId: Guid
  +PetId: Guid
  +BehaviorType: BehaviorType
  +Severity: Severity
  +Description: string
  +Triggers: List<string>
  +Context: string?
  +Duration: int?
  +OccurredAt: DateTime
  +ActionsTaken: string?
  +RequiresFollowUp: bool
  +IsResolved: bool
  +LoggedBy: Guid
  +LoggedAt: DateTime
  +UpdatedAt: DateTime?
  --
  +Validate(): ValidationResult
  +AddTrigger(trigger): void
  +MarkAsResolved(): void
  +UpdateFollowUpStatus(status): void
}

' Value Objects
class GoalProgress <<Value Object>> VALUE_OBJECT_COLOR {
  +CurrentDurationMinutes: int
  +CurrentDistance: decimal
  +CurrentCalories: decimal
  +CurrentSessionsCount: int
  +ProgressPercentage: double
  +IsCompleted: bool
  +DaysRemaining: int?
  --
  +CalculatePercentage(): double
  +GetStatus(): string
}

class ActivityStatistics <<Value Object>> VALUE_OBJECT_COLOR {
  +TotalSessions: int
  +TotalDurationMinutes: int
  +TotalDistanceMeters: decimal
  +TotalCaloriesBurned: decimal
  +AverageSessionDuration: double
  +MostCommonActivity: string
  +GoalCompletionRate: double
  --
  +CalculateAverages(): void
  +CompareToPrevious(stats): ComparisonResult
}

class BehaviorPattern <<Value Object>> VALUE_OBJECT_COLOR {
  +TotalIncidents: int
  +MostCommonBehavior: BehaviorType
  +MostCommonTriggers: List<string>
  +SeverityDistribution: Dictionary<Severity, int>
  +TrendDirection: TrendDirection
  +Recommendations: List<string>
  --
  +AnalyzePatterns(): void
  +GenerateRecommendations(): List<string>
}

' Enumerations
enum IntensityLevel {
  Low
  Medium
  High
}

enum GoalType {
  Daily
  Weekly
  Monthly
}

enum GoalStatus {
  Active
  Completed
  Failed
  Cancelled
}

enum BehaviorType {
  Aggression
  Anxiety
  Destructive
  Excessive
  Other
}

enum Severity {
  Minor
  Moderate
  Severe
}

enum TrendDirection {
  Improving
  Stable
  Worsening
}

' Domain Events
class ExerciseSessionLogged <<Domain Event>> DOMAIN_EVENT_COLOR {
  +EventId: Guid
  +PetId: Guid
  +SessionId: Guid
  +ActivityType: string
  +DurationMinutes: int
  +DistanceMeters: decimal?
  +IntensityLevel: IntensityLevel
  +CaloriesBurned: decimal?
  +StartTime: DateTime
  +EndTime: DateTime
  +Notes: string?
  +LocationName: string?
  +OwnerId: Guid
  +LoggedAt: DateTime
}

class ExerciseGoalSet <<Domain Event>> DOMAIN_EVENT_COLOR {
  +EventId: Guid
  +PetId: Guid
  +GoalId: Guid
  +GoalType: GoalType
  +TargetDurationMinutes: int?
  +TargetDistance: decimal?
  +TargetCalories: decimal?
  +TargetSessionsCount: int?
  +StartDate: DateTime
  +EndDate: DateTime?
  +IsRecurring: bool
  +SetBy: Guid
  +CreatedAt: DateTime
}

class BehaviorIncidentLogged <<Domain Event>> DOMAIN_EVENT_COLOR {
  +EventId: Guid
  +PetId: Guid
  +IncidentId: Guid
  +BehaviorType: BehaviorType
  +Severity: Severity
  +Description: string
  +Triggers: List<string>
  +Context: string?
  +Duration: int?
  +OccurredAt: DateTime
  +ActionsTaken: string?
  +RequiresFollowUp: bool
  +LoggedBy: Guid
  +LoggedAt: DateTime
}

' Domain Services
class ActivityCalculationService <<Domain Service>> SERVICE_COLOR {
  +CalculateCaloriesBurned(session, petProfile): decimal
  +EstimateDistance(duration, intensity, activityType): decimal
  +CalculateDailyTarget(petProfile): int
  +GetRecommendedGoals(petProfile): List<ExerciseGoal>
}

class GoalProgressService <<Domain Service>> SERVICE_COLOR {
  +CalculateProgress(goal, sessions): GoalProgress
  +CheckGoalCompletion(goal): bool
  +UpdateGoalStatus(goal): void
  +GetActiveSessions(petId, dateRange): List<ExerciseSession>
}

class BehaviorAnalysisService <<Domain Service>> SERVICE_COLOR {
  +AnalyzePatterns(incidents): BehaviorPattern
  +IdentifyTriggers(incidents): List<string>
  +AssessSeverityTrend(incidents): TrendDirection
  +GenerateRecommendations(pattern): List<string>
}

' Repositories
interface IExerciseSessionRepository {
  +GetById(sessionId): ExerciseSession?
  +GetByPetId(petId, filters): List<ExerciseSession>
  +GetByDateRange(petId, startDate, endDate): List<ExerciseSession>
  +Add(session): void
  +Update(session): void
  +Delete(sessionId): void
  +GetStatistics(petId, period): ActivityStatistics
}

interface IExerciseGoalRepository {
  +GetById(goalId): ExerciseGoal?
  +GetByPetId(petId): List<ExerciseGoal>
  +GetActiveGoals(petId): List<ExerciseGoal>
  +Add(goal): void
  +Update(goal): void
  +Delete(goalId): void
}

interface IBehaviorIncidentRepository {
  +GetById(incidentId): BehaviorIncident?
  +GetByPetId(petId, filters): List<BehaviorIncident>
  +GetByDateRange(petId, startDate, endDate): List<BehaviorIncident>
  +Add(incident): void
  +Update(incident): void
  +Delete(incidentId): void
  +GetPatterns(petId): BehaviorPattern
}

' Event Handlers
class ActivityStatisticsHandler <<Event Handler>> SERVICE_COLOR {
  +Handle(event: ExerciseSessionLogged): void
}

class GoalProgressHandler <<Event Handler>> SERVICE_COLOR {
  +Handle(event: ExerciseSessionLogged): void
  +Handle(event: ExerciseGoalSet): void
}

class NotificationHandler <<Event Handler>> SERVICE_COLOR {
  +Handle(event: ExerciseSessionLogged): void
  +Handle(event: ExerciseGoalSet): void
  +Handle(event: BehaviorIncidentLogged): void
}

class BehaviorAnalysisHandler <<Event Handler>> SERVICE_COLOR {
  +Handle(event: BehaviorIncidentLogged): void
}

' Relationships

' Aggregate relationships
ExerciseSession --> IntensityLevel
ExerciseGoal --> GoalType
ExerciseGoal --> GoalStatus
ExerciseGoal ..> GoalProgress : creates
BehaviorIncident --> BehaviorType
BehaviorIncident --> Severity

' Value object relationships
BehaviorPattern --> BehaviorType
BehaviorPattern --> Severity
BehaviorPattern --> TrendDirection

' Domain Events
ExerciseSession ..> ExerciseSessionLogged : publishes
ExerciseGoal ..> ExerciseGoalSet : publishes
BehaviorIncident ..> BehaviorIncidentLogged : publishes

' Services using entities
ActivityCalculationService ..> ExerciseSession : calculates
GoalProgressService ..> ExerciseGoal : updates
GoalProgressService ..> ExerciseSession : reads
GoalProgressService ..> GoalProgress : creates
BehaviorAnalysisService ..> BehaviorIncident : analyzes
BehaviorAnalysisService ..> BehaviorPattern : creates

' Event handlers
ActivityStatisticsHandler ..> ExerciseSessionLogged : handles
GoalProgressHandler ..> ExerciseSessionLogged : handles
GoalProgressHandler ..> ExerciseGoalSet : handles
NotificationHandler ..> ExerciseSessionLogged : handles
NotificationHandler ..> ExerciseGoalSet : handles
NotificationHandler ..> BehaviorIncidentLogged : handles
BehaviorAnalysisHandler ..> BehaviorIncidentLogged : handles

' Repository relationships
IExerciseSessionRepository ..> ExerciseSession
IExerciseSessionRepository ..> ActivityStatistics
IExerciseGoalRepository ..> ExerciseGoal
IBehaviorIncidentRepository ..> BehaviorIncident
IBehaviorIncidentRepository ..> BehaviorPattern

note top of ExerciseSession
  Aggregate Root for tracking
  individual exercise activities
end note

note top of ExerciseGoal
  Aggregate Root for managing
  pet activity targets and goals
end note

note top of BehaviorIncident
  Aggregate Root for documenting
  behavioral observations
end note

note right of ActivityCalculationService
  Domain service for calculating
  activity-related metrics
end note

note bottom of GoalProgressService
  Handles goal progress tracking
  and completion logic
end note

@enduml
