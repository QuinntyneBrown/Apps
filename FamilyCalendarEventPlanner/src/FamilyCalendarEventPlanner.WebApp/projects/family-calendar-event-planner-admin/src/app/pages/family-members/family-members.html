<div class="family-members">
  <div class="family-members__header">
    <div class="family-members__header-content">
      <h1 class="family-members__title">
        <mat-icon>group</mat-icon>
        Family Members
      </h1>
      <p class="family-members__description">Manage family members for your family calendar.</p>
    </div>
    <button mat-raised-button color="primary" (click)="onCreateMember()">
      <mat-icon>person_add</mat-icon>
      Create Member
    </button>
  </div>

  <div class="family-members__filters">
    <mat-button-toggle-group [value]="(immediateFilter$ | async)" (change)="onFilterChange($event.value)">
      <mat-button-toggle value="all">All Members</mat-button-toggle>
      <mat-button-toggle value="immediate">Immediate Family</mat-button-toggle>
      <mat-button-toggle value="extended">Extended Family</mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <div class="family-members__table-container">
    <table mat-table [dataSource]="(members$ | async) || []" class="family-members__table">
      <!-- Avatar Column -->
      <ng-container matColumnDef="avatar">
        <th mat-header-cell *matHeaderCellDef>Avatar</th>
        <td mat-cell *matCellDef="let member">
          <div class="family-members__avatar" [style.background-color]="member.color">
            {{ getInitials(member.name) }}
          </div>
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let member">{{ member.name }}</td>
      </ng-container>

      <!-- Email Column -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let member">{{ member.email || '-' }}</td>
      </ng-container>

      <!-- Relation Type Column -->
      <ng-container matColumnDef="relationType">
        <th mat-header-cell *matHeaderCellDef>Relation</th>
        <td mat-cell *matCellDef="let member">{{ getRelationTypeLabel(member.relationType) }}</td>
      </ng-container>

      <!-- Role Column -->
      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef>Role</th>
        <td mat-cell *matCellDef="let member">
          <span class="family-members__role-badge" [class.family-members__role-badge--admin]="isAdminRole(member.role)">
            {{ getRoleLabel(member.role) }}
          </span>
        </td>
      </ng-container>

      <!-- Is Immediate Column -->
      <ng-container matColumnDef="isImmediate">
        <th mat-header-cell *matHeaderCellDef>Immediate</th>
        <td mat-cell *matCellDef="let member">
          <mat-icon [class.family-members__immediate--yes]="member.isImmediate"
                    [class.family-members__immediate--no]="!member.isImmediate">
            {{ member.isImmediate ? 'check_circle' : 'cancel' }}
          </mat-icon>
        </td>
      </ng-container>

      <!-- Color Column -->
      <ng-container matColumnDef="color">
        <th mat-header-cell *matHeaderCellDef>Color</th>
        <td mat-cell *matCellDef="let member">
          <div class="family-members__color-indicator" [style.background-color]="member.color"></div>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let member">
          <div class="family-members__actions">
            <button mat-icon-button color="primary" (click)="onEditMember(member)" matTooltip="Edit">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="onDeleteMember(member)" matTooltip="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- No Data Row -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell family-members__no-data" [attr.colspan]="displayedColumns.length">
          <div class="family-members__empty-state">
            <mat-icon>group_off</mat-icon>
            <p>No family members found</p>
            <button mat-raised-button color="primary" (click)="onCreateMember()">
              <mat-icon>person_add</mat-icon>
              Create First Member
            </button>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>
