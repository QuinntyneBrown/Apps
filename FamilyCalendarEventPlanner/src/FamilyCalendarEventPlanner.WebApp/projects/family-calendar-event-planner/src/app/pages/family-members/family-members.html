<div class="family-members">
  <div class="family-members__header">
    <div class="family-members__header-content">
      <h1 class="family-members__title">
        <mat-icon>group</mat-icon>
        Family Members
      </h1>
      <p class="family-members__description">
        Add family members, assign colors, and manage permissions for your family calendar.
      </p>
    </div>
    <button mat-raised-button color="primary" (click)="onAddMember()">
      <mat-icon>person_add</mat-icon>
      Invite Member
    </button>
  </div>

  <div class="family-members__filters">
    <mat-button-toggle-group [value]="(immediateFilter$ | async)" (change)="onFilterChange($event.value)">
      <mat-button-toggle value="all">All Members</mat-button-toggle>
      <mat-button-toggle value="immediate">Immediate Family</mat-button-toggle>
      <mat-button-toggle value="extended">Extended Family</mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  @if (viewModel$ | async; as vm) {
    <div class="family-members__stats">
      <mat-card class="family-members__stat-card">
        <div class="family-members__stat-number">{{ vm.stats.activeMembers }}</div>
        <div class="family-members__stat-label">Active Members</div>
      </mat-card>
      <mat-card class="family-members__stat-card">
        <div class="family-members__stat-number">{{ vm.stats.immediateFamily }}</div>
        <div class="family-members__stat-label">Immediate Family</div>
      </mat-card>
      <mat-card class="family-members__stat-card">
        <div class="family-members__stat-number">{{ vm.stats.admins }}</div>
        <div class="family-members__stat-label">Admins</div>
      </mat-card>
    </div>

    <div class="family-members__grid">
      @for (member of vm.members; track member.memberId) {
        <app-member-card
          [member]="member"
          [eventCount]="getEventCount(vm.memberEventCounts, member.memberId)"
          (editClick)="onEditMember($event)"
          (viewScheduleClick)="onViewSchedule($event)">
        </app-member-card>
      }

      <mat-card class="family-members__add-card" (click)="onAddMember()">
        <div class="family-members__add-content">
          <mat-icon>person_add</mat-icon>
          <h3>Add New Family Member</h3>
          <p>Invite a family member to join your calendar</p>
        </div>
      </mat-card>
    </div>
  } @else {
    <div class="family-members__loading">
      <mat-icon>hourglass_empty</mat-icon>
      <p>Loading family members...</p>
    </div>
  }
</div>
