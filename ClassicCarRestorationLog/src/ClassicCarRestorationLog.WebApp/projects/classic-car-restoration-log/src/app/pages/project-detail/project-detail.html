<div class="project-detail" *ngIf="(project$ | async) as project">
  <div class="project-detail__header">
    <a mat-icon-button routerLink="/" class="project-detail__back">
      <mat-icon>arrow_back</mat-icon>
    </a>
    <div class="project-detail__header-info">
      <h1 class="project-detail__title">
        {{ project.year }} {{ project.carMake }} {{ project.carModel }}
      </h1>
      <mat-chip-set>
        <mat-chip [color]="getPhaseColor(project.phase)" highlighted>
          {{ getPhaseLabel(project.phase) }}
        </mat-chip>
      </mat-chip-set>
    </div>
  </div>

  <div class="project-detail__overview">
    <mat-card>
      <mat-card-content>
        <div class="project-detail__stats">
          <div class="project-detail__stat">
            <mat-icon>event</mat-icon>
            <div>
              <span class="project-detail__stat-label">Start Date</span>
              <span class="project-detail__stat-value">{{ project.startDate | date:'mediumDate' }}</span>
            </div>
          </div>
          <div class="project-detail__stat" *ngIf="project.estimatedBudget">
            <mat-icon>attach_money</mat-icon>
            <div>
              <span class="project-detail__stat-label">Budget</span>
              <span class="project-detail__stat-value">${{ project.estimatedBudget | number:'1.2-2' }}</span>
            </div>
          </div>
          <div class="project-detail__stat" *ngIf="project.actualCost">
            <mat-icon>receipt</mat-icon>
            <div>
              <span class="project-detail__stat-label">Actual Cost</span>
              <span class="project-detail__stat-value">${{ project.actualCost | number:'1.2-2' }}</span>
            </div>
          </div>
          <div class="project-detail__stat" *ngIf="(parts$ | async) as parts">
            <mat-icon>build</mat-icon>
            <div>
              <span class="project-detail__stat-label">Parts Cost</span>
              <span class="project-detail__stat-value">${{ getTotalPartsCost(parts) | number:'1.2-2' }}</span>
            </div>
          </div>
          <div class="project-detail__stat" *ngIf="(workLogs$ | async) as workLogs">
            <mat-icon>schedule</mat-icon>
            <div>
              <span class="project-detail__stat-label">Total Hours</span>
              <span class="project-detail__stat-value">{{ getTotalHoursWorked(workLogs) }} hrs</span>
            </div>
          </div>
        </div>
        <p class="project-detail__notes" *ngIf="project.notes">{{ project.notes }}</p>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-tab-group class="project-detail__tabs">
    <mat-tab label="Parts">
      <div class="project-detail__tab-content">
        <div *ngIf="(parts$ | async) as parts">
          <table mat-table [dataSource]="parts" *ngIf="parts.length > 0; else noParts">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let part">{{ part.name }}</td>
            </ng-container>

            <ng-container matColumnDef="partNumber">
              <th mat-header-cell *matHeaderCellDef>Part Number</th>
              <td mat-cell *matCellDef="let part">{{ part.partNumber || '-' }}</td>
            </ng-container>

            <ng-container matColumnDef="supplier">
              <th mat-header-cell *matHeaderCellDef>Supplier</th>
              <td mat-cell *matCellDef="let part">{{ part.supplier || '-' }}</td>
            </ng-container>

            <ng-container matColumnDef="cost">
              <th mat-header-cell *matHeaderCellDef>Cost</th>
              <td mat-cell *matCellDef="let part">{{ part.cost ? ('$' + (part.cost | number:'1.2-2')) : '-' }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let part">
                <mat-chip-set>
                  <mat-chip [color]="part.isInstalled ? 'primary' : 'accent'" highlighted>
                    {{ part.isInstalled ? 'Installed' : 'Pending' }}
                  </mat-chip>
                </mat-chip-set>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="partsColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: partsColumns;"></tr>
          </table>
        </div>
      </div>
    </mat-tab>

    <mat-tab label="Work Logs">
      <div class="project-detail__tab-content">
        <div *ngIf="(workLogs$ | async) as workLogs">
          <table mat-table [dataSource]="workLogs" *ngIf="workLogs.length > 0; else noWorkLogs">
            <ng-container matColumnDef="workDate">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let log">{{ log.workDate | date:'mediumDate' }}</td>
            </ng-container>

            <ng-container matColumnDef="hoursWorked">
              <th mat-header-cell *matHeaderCellDef>Hours</th>
              <td mat-cell *matCellDef="let log">{{ log.hoursWorked }}</td>
            </ng-container>

            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Description</th>
              <td mat-cell *matCellDef="let log">{{ log.description }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="workLogsColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: workLogsColumns;"></tr>
          </table>
        </div>
      </div>
    </mat-tab>

    <mat-tab label="Photo Logs">
      <div class="project-detail__tab-content">
        <div *ngIf="(photoLogs$ | async) as photoLogs">
          <table mat-table [dataSource]="photoLogs" *ngIf="photoLogs.length > 0; else noPhotoLogs">
            <ng-container matColumnDef="photoDate">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let log">{{ log.photoDate | date:'mediumDate' }}</td>
            </ng-container>

            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Description</th>
              <td mat-cell *matCellDef="let log">{{ log.description || '-' }}</td>
            </ng-container>

            <ng-container matColumnDef="phase">
              <th mat-header-cell *matHeaderCellDef>Phase</th>
              <td mat-cell *matCellDef="let log">
                <mat-chip-set *ngIf="log.phase !== null && log.phase !== undefined">
                  <mat-chip [color]="getPhaseColor(log.phase)" highlighted>
                    {{ getPhaseLabel(log.phase) }}
                  </mat-chip>
                </mat-chip-set>
                <span *ngIf="log.phase === null || log.phase === undefined">-</span>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="photoLogsColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: photoLogsColumns;"></tr>
          </table>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<ng-template #noParts>
  <div class="project-detail__empty">
    <p>No parts added yet</p>
  </div>
</ng-template>

<ng-template #noWorkLogs>
  <div class="project-detail__empty">
    <p>No work logs added yet</p>
  </div>
</ng-template>

<ng-template #noPhotoLogs>
  <div class="project-detail__empty">
    <p>No photo logs added yet</p>
  </div>
</ng-template>
