@startuml Appliance Tracking - Add Appliance Sequence

title Add Appliance Workflow

actor "Homeowner" as user
participant "Appliance UI" as ui
participant "API Controller" as api
participant "ApplianceHandler" as handler
participant "Appliance Repository" as repo
participant "Task Service" as tasks
participant "Event Publisher" as events

autonumber

user -> ui: Click "Add Appliance"
activate ui

ui -> ui: Show appliance form

user -> ui: Enter details (name, brand, model)
user -> ui: Set purchase date & cost
user -> ui: Set warranty expiration
user -> ui: Upload photos
user -> ui: Upload manual PDF
user -> ui: Submit

ui -> api: POST /api/appliances
activate api

api -> handler: Handle(AddApplianceCommand)
activate handler

handler -> handler: Create Appliance entity
handler -> handler: Validate warranty expiration
handler -> handler: Calculate expected replacement date

handler -> repo: CreateAsync(appliance)
activate repo
repo --> handler: Appliance created
deactivate repo

== Create Maintenance Schedule ==

alt Appliance has maintenance requirements
    handler -> tasks: CreateMaintenanceSchedule(appliance)
    activate tasks
    tasks -> tasks: Determine maintenance interval
    tasks -> tasks: Create recurring maintenance tasks
    tasks --> handler: Tasks created
    deactivate tasks
end

handler -> events: Publish(ApplianceAddedEvent)
activate events
events --> handler: Event published
deactivate events

handler --> api: Success
deactivate handler

api --> ui: 201 Created {appliance}
deactivate api

ui -> ui: Update appliance inventory
ui --> user: Appliance added successfully
deactivate ui

group Background Event Handlers
    events -> events: Schedule warranty expiration alerts
    events -> events: Add to replacement planning
    events -> events: Update property inventory
end

@enduml
