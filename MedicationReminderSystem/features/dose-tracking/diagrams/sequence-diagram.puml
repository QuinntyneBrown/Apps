@startuml Log Dose Sequence

actor User
participant UI
participant API
participant DoseService
participant DoubleDoseChecker
participant EventBus

User -> UI: Click "Take Dose"
UI -> API: POST /api/doses/taken
API -> DoubleDoseChecker: CheckDoubleDose(medicationId)
alt Too Soon
    DoubleDoseChecker -> EventBus: Raise DoubleDoseAlert
    DoubleDoseChecker --> API: Error: Too soon
    API --> UI: 400 Bad Request
    UI --> User: Warning dialog
else Safe to Take
    API -> DoseService: LogDoseTaken(command)
    DoseService -> EventBus: Raise DoseTaken event
    DoseService --> API: Success
    API --> UI: 200 OK
    UI --> User: Success notification
end

@enduml
