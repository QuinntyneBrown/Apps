<div class="habit-detail">
  <ng-container *ngIf="viewModel$ | async as vm; else loading">
    <div class="habit-detail__container">
      <div class="habit-detail__header">
        <button mat-icon-button (click)="onBack()" aria-label="Go back">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <h1 class="habit-detail__title">{{ vm.habit.name }}</h1>
        <div class="habit-detail__actions">
          <button mat-raised-button color="primary" (click)="onComplete(vm.habit.habitId)">
            <mat-icon>check_circle</mat-icon>
            Complete
          </button>
          <button mat-button (click)="onEdit(vm.habit)">
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          <button mat-button (click)="onArchive(vm.habit.habitId)">
            <mat-icon>archive</mat-icon>
            Archive
          </button>
        </div>
      </div>

      <div class="habit-detail__content">
        <mat-card class="habit-detail__card">
          <mat-card-header>
            <mat-card-title>Overview</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="habit-detail__info">
              <div class="habit-detail__info-item">
                <span class="habit-detail__info-label">Description:</span>
                <span class="habit-detail__info-value">{{ vm.habit.description || 'No description' }}</span>
              </div>
              <div class="habit-detail__info-item">
                <span class="habit-detail__info-label">Frequency:</span>
                <span class="habit-detail__info-value">{{ getFrequencyDisplay(vm.habit) }}</span>
              </div>
              <div class="habit-detail__info-item">
                <span class="habit-detail__info-label">Start Date:</span>
                <span class="habit-detail__info-value">{{ vm.habit.startDate | date:'mediumDate' }}</span>
              </div>
              <div class="habit-detail__info-item">
                <span class="habit-detail__info-label">Status:</span>
                <span class="habit-detail__info-value">{{ vm.habit.isActive ? 'Active' : 'Archived' }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="habit-detail__card" *ngIf="vm.streak">
          <mat-card-header>
            <mat-card-title>Streak Statistics</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="habit-detail__streak-stats">
              <div class="habit-detail__stat">
                <div class="habit-detail__stat-value">
                  <mat-icon class="habit-detail__stat-icon">local_fire_department</mat-icon>
                  {{ vm.streak.currentStreak }}
                </div>
                <div class="habit-detail__stat-label">Current Streak</div>
              </div>
              <div class="habit-detail__stat">
                <div class="habit-detail__stat-value">
                  <mat-icon class="habit-detail__stat-icon">emoji_events</mat-icon>
                  {{ vm.streak.longestStreak }}
                </div>
                <div class="habit-detail__stat-label">Longest Streak</div>
              </div>
              <div class="habit-detail__stat" *ngIf="vm.streak.lastCompletedDate">
                <div class="habit-detail__stat-value">
                  {{ vm.streak.lastCompletedDate | date:'shortDate' }}
                </div>
                <div class="habit-detail__stat-label">Last Completed</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="habit-detail__card" *ngIf="vm.habit.notes">
          <mat-card-header>
            <mat-card-title>Notes</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p class="habit-detail__notes">{{ vm.habit.notes }}</p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </ng-container>

  <ng-template #loading>
    <div class="habit-detail__loading">
      <mat-spinner></mat-spinner>
    </div>
  </ng-template>
</div>
