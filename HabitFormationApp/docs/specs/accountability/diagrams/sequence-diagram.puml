@startuml Accountability - Sequence Diagram

title Add Accountability Partner

actor User
participant "API" as API
participant "AddPartnerHandler" as Handler
participant "Partnership" as Partner
participant "EventPublisher" as Events
participant "NotificationService" as Notify

User -> API: POST /api/accountability/partners
activate API
API -> Handler: AddAccountabilityPartnerCommand
activate Handler

Handler -> Partner: Create(userId, partnerId, habitId)
activate Partner
Partner -> Partner: Set status = Pending
Partner --> Handler: Partnership
deactivate Partner

Handler -> Events: Publish(AccountabilityPartnerAdded)
activate Events
Events --> Handler: Published
deactivate Events

Handler --> API: 201 Created
deactivate Handler
API --> User: PartnershipDto
deactivate API

Events -> Notify: Send invitation to partner
activate Notify
Notify -> Notify: Create notification
Notify --> Events: Sent
deactivate Notify

@enduml
