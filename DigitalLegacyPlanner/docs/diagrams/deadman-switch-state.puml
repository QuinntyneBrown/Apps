@startuml DeadManSwitch_State
skinparam backgroundColor #FEFEFE
skinparam state {
    BackgroundColor #E8F5E9
    BorderColor #388E3C
    ArrowColor #666666
}

[*] --> Inactive : User creates account

Inactive --> Active : User configures\nemergency protocol

state Active {
    [*] --> Monitoring

    Monitoring --> WarningPeriod : 60 days inactivity
    Monitoring --> Monitoring : User confirms\nactivity

    state WarningPeriod {
        [*] --> FirstWarning
        FirstWarning --> SecondWarning : 7 days no response
        SecondWarning --> FinalWarning : 3 days no response
        FinalWarning --> [*] : 1 day
    }

    WarningPeriod --> Monitoring : User confirms\nactivity (reset)
    WarningPeriod --> Triggered : No response\nafter 30 days
}

state Triggered {
    [*] --> NotificationSent
    NotificationSent --> WaitingPeriod : Executors notified

    state WaitingPeriod {
        [*] --> CountingDown
        CountingDown --> DocumentationRequired : Executor requests\naccess
        DocumentationRequired --> VerificationPending : Documents submitted
        VerificationPending --> [*] : Verified
    }

    WaitingPeriod --> AccessGranted : Waiting period\ncomplete + verified
}

state AccessGranted {
    [*] --> CredentialsReleased
    CredentialsReleased --> InstructionsProvided
    InstructionsProvided --> AuditLogged
    AuditLogged --> [*]
}

Triggered --> Active : False alarm\n(user returns)
AccessGranted --> [*] : Legacy executed

note right of WarningPeriod
  Multiple warnings sent via:
  - Email
  - SMS
  - Push notification
end note

note right of WaitingPeriod
  Default: 30 days
  Configurable: 0-90 days

  Required documentation:
  - Death certificate
  - Executor identification
  - Legal authorization
end note

note right of AccessGranted
  All access is:
  - Time-limited
  - Fully audited
  - Revocable
end note

@enduml
