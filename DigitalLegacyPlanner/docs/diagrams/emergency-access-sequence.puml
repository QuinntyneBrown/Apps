@startuml Emergency_Access_Flow
autonumber
skinparam backgroundColor #FEFEFE
skinparam sequenceArrowThickness 2
skinparam roundcorner 10

actor User
actor Executor
participant "Dead Man's\nSwitch" as DMS
participant "Emergency\nService" as ES
participant "Notification\nService" as NS
participant "Vault\nService" as VS
database "Encrypted\nVault" as Vault

== Normal Activity ==
User -> DMS: Confirm activity (periodic)
activate DMS
DMS -> DMS: Reset inactivity timer
DMS --> User: Confirmation recorded
deactivate DMS

== Inactivity Detected ==
DMS -> DMS: Detect 60 days inactivity
activate DMS
DMS -> NS: Send warning (30 days before trigger)
NS -> User: Email: "Confirm you're active"
deactivate DMS

... 23 days pass without response ...

DMS -> NS: Send urgent warning (7 days)
NS -> User: Email + SMS: "URGENT: Confirm activity"

... 7 more days pass ...

== Dead Man's Switch Activation ==
DMS -> ES: Activate emergency protocol
activate ES
ES -> ES: Begin waiting period (30 days)
ES -> NS: Notify all executors
deactivate ES
NS -> Executor: Email: "Emergency access initiated"

== Executor Request ==
Executor -> ES: Request emergency access
activate ES
ES -> ES: Verify executor identity
ES -> Executor: Request documentation
deactivate ES

Executor -> ES: Submit death certificate
activate ES
ES -> ES: Verify documentation
ES -> ES: Check waiting period elapsed
ES -> NS: Notify admin for approval
deactivate ES

== Access Grant ==
ES -> ES: Admin approves access
activate ES
ES -> VS: Request access package
activate VS
VS -> Vault: Decrypt credentials
Vault --> VS: Decrypted data
VS --> ES: Access package prepared
deactivate VS

ES -> Executor: Grant access (secure link)
ES -> NS: Log access grant
deactivate ES

Executor -> VS: Access legacy information
activate VS
VS --> Executor: Credentials & instructions
VS -> ES: Audit log access
deactivate VS

note right of ES
  All access attempts are
  logged and auditable
end note

@enduml
