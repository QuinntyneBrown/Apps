@startuml Wine Collection Sequence Diagram

actor Collector
participant "UI" as UI
participant "Controller" as Controller
participant "Handler" as Handler
participant "WineBottle" as Wine
participant "Repository" as Repo
participant "EventBus" as Events

== Acquire Wine ==
Collector -> UI: Add wine to collection
UI -> Controller: POST /api/wines
activate Controller
Controller -> Handler: Handle(AcquireWineBottleCommand)
activate Handler
Handler -> Wine: Create()
activate Wine
Wine -> Wine: Validate vintage and details
Wine --> Handler: Wine created
deactivate Wine
Handler -> Repo: AddAsync(wine)
Handler -> Events: Publish(WineBottleAcquired)
Handler --> Controller: Wine DTO
deactivate Handler
Controller --> UI: 201 Created
deactivate Controller
UI -> Collector: Show success

== Open Bottle ==
Collector -> UI: Open bottle for tasting
UI -> Controller: POST /api/wines/{id}/open
activate Controller
Controller -> Handler: Handle(OpenBottleCommand)
activate Handler
Handler -> Repo: GetByIdAsync(bottleId)
Repo --> Handler: WineBottle
Handler -> Wine: Open(occasion, companions)
activate Wine
Wine -> Wine: Reduce quantity
Wine -> Wine: Update status if needed
Wine --> Handler: Opened
deactivate Wine
Handler -> Repo: UpdateAsync(wine)
Handler -> Events: Publish(BottleOpened)
Handler --> Controller: Success
deactivate Handler
Controller --> UI: 200 OK
deactivate Controller
UI -> Collector: Prompt for tasting notes

@enduml
