@startuml delete-user
title Delete User Flow

actor Admin
participant "User Management\nPage" as UI
participant "User Service\n(Angular)" as UserService
participant "Users Controller\n(/api/users)" as UsersController
participant "Delete User\nCommand Handler" as CommandHandler
database "CarModificationPartsDatabase\nContext" as DB

Admin -> UI: Click Delete button on user row
UI -> UI: Show confirmation dialog\n"Are you sure you want to\ndelete this user?"

alt Admin cancels
    Admin -> UI: Click Cancel
    UI -> Admin: Close dialog, no action taken
else Admin confirms
    Admin -> UI: Click Confirm Delete

    UI -> UserService: deleteUser(userId)
    UserService -> UsersController: DELETE /api/users/{userId}

    UsersController -> CommandHandler: Handle DeleteUserCommand

    CommandHandler -> DB: Query User by userId\nwith TenantId filter
    DB --> CommandHandler: Return User entity

    alt User not found
        CommandHandler --> UsersController: 404 Not Found
        UsersController --> UserService: User deletion failed
        UserService --> UI: Show error message
        UI -> Admin: Display "User not found"
    else User exists
        CommandHandler -> DB: Remove User entity\n(hard delete including UserRole associations)
        DB -> DB: Delete UserRole associations
        DB -> DB: Delete User entity
        DB --> CommandHandler: User deleted successfully

        CommandHandler --> UsersController: 204 No Content

        UsersController --> UserService: User deleted successfully
        UserService --> UI: User deletion successful
        UI -> UI: Remove user from list
        UI -> Admin: Display success message\n"User deleted successfully"
    end
end

@enduml
