@startuml create-part
title Create Part Flow

actor User
participant "Parts Dashboard" as UI
participant "Part Form\nComponent" as FormUI
participant "Part Service\n(Angular)" as PartService
participant "Parts Controller\n(/api/parts)" as PartsController
participant "Create Part\nCommand Handler" as CommandHandler
participant "ITenantContext" as TenantContext
database "CarModificationPartsDatabase\nContext" as DB

User -> UI: Click "Add New Part" button
UI -> FormUI: Open part creation modal/form

User -> FormUI: Enter part details\n(name, description, category,\nprice, manufacturer, etc.)

alt File upload included
    User -> FormUI: Select file(s) to upload\n(images, documents)
    FormUI -> FormUI: Validate file type and size
end

User -> FormUI: Click Save button

FormUI -> FormUI: Validate form inputs\n(required fields, data types,\nfield constraints)

alt Form invalid
    FormUI -> User: Display validation errors\n(highlight invalid fields)
else Form valid
    FormUI -> PartService: createPart(partData, files?)

    alt Files included
        PartService -> PartService: Prepare multipart/form-data\nwith part data and files
        PartService -> PartsController: POST /api/parts\nContent-Type: multipart/form-data
    else No files
        PartService -> PartsController: POST /api/parts\nContent-Type: application/json\n{partData}
    end

    PartsController -> CommandHandler: Handle CreatePartCommand

    CommandHandler -> TenantContext: Get current TenantId
    TenantContext --> CommandHandler: Return TenantId

    CommandHandler -> CommandHandler: Create Part entity\n(partId=Guid, name, description,\ncategory, price, manufacturer,\ntenantId, etc.)

    alt Files included
        CommandHandler -> CommandHandler: Process uploaded files\n(save to storage, generate URLs)
        CommandHandler -> CommandHandler: Attach file references to Part
    end

    CommandHandler -> DB: SaveChanges()\nInsert Part entity
    DB --> CommandHandler: Part created successfully

    CommandHandler -> CommandHandler: Map Part to DTO
    CommandHandler --> PartsController: 201 Created\n{partId, name, description,\ncategory, price, imageUrls, etc.}

    PartsController --> PartService: Part created successfully\nwith part DTO
    PartService --> FormUI: Part creation successful
    FormUI -> FormUI: Close form/modal
    FormUI -> UI: Notify parent component
    UI -> UI: Refresh parts list\n(fetch updated data)
    UI -> User: Display success message\n"Part added successfully"
end

@enduml
