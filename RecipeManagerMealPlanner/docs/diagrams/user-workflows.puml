@startuml User Workflows

title Key User Workflows

== Workflow 1: Add Recipe and Plan Meal ==

|User|
start
:Browse recipe website;
:Copy recipe URL;

|Recipe Service|
:Import recipe from URL;
:Parse ingredients and instructions;
:Calculate nutrition;
:Save recipe;
:Emit **RecipeAdded** event;

|User|
:View imported recipe;
:Add to favorites;

|Recipe Service|
:Mark as favorite;
:Emit **RecipeFavorited** event;

|User|
:Open meal calendar;
:Drag recipe to date;

|Meal Plan Service|
:Create meal plan;
:Emit **MealPlanned** event;

|Grocery Service|
:Add ingredients to shopping list;
:Emit **GroceryItemAdded** events;

|User|
:View updated shopping list;
stop

== Workflow 2: Weekly Meal Planning ==

|User|
start
:Click "Generate Week Plan";
:Select preferences and date range;

|Meal Plan Service|
:Generate balanced weekly plan;
:Emit **MealPlanWeekGenerated** event;

|Grocery Service|
:Consolidate all ingredients;
:Check pantry inventory;
:Generate shopping list;
:Emit **GroceryListGenerated** event;

|Nutrition Service|
:Calculate weekly nutrition;
:Check against goals;
if (Dietary violation?) then (yes)
  :Emit **DietaryViolationDetected** event;

  |Notification Service|
  :Send alert to user;
else (no)
endif

|User|
:Review meal plan;
if (Satisfied?) then (no)
  :Regenerate or modify meals;
else (yes)
  :Confirm plan;
  :View shopping list;
endif
stop

== Workflow 3: Shopping and Cooking ==

|User|
start
:Go shopping with list;
:Check items as purchased;

|Grocery Service|
:Update purchase status;
:Emit **GroceryItemPurchased** events;

|User|
:Complete shopping trip;

|Grocery Service|
:Finalize trip;
:Emit **ShoppingTripCompleted** event;

|Pantry Service|
:Add items to pantry;
:Emit **PantryItemAdded** events;

|User|
:Cook planned meal;
:Follow recipe instructions;
:Mark meal as complete;

|Meal Plan Service|
:Log completion;
:Emit **MealCompleted** event;

|Pantry Service|
:Deduct ingredients used;
:Emit **PantryItemUsed** events;

if (Leftovers?) then (yes)
  |User|
  :Log leftover quantity;

  |Leftovers Service|
  :Create leftover entry;
  :Emit **LeftoversLogged** event;
else (no)
endif

|User|
:Rate recipe;

|Recipe Service|
:Save rating;
:Emit **RecipeRated** event;
:Update recipe popularity;

stop

== Workflow 4: Pantry Expiration Management ==

|Background Job|
start
:Run daily expiration check;

|Pantry Service|
:Scan pantry items;
if (Items expiring soon?) then (yes)
  :Emit **PantryItemExpiring** events;

  |Notification Service|
  :Send expiration alerts;

  |Recipe Service|
  :Find recipes using ingredient;

  |User|
  :Receive notification;
  :View recipe suggestions;
  if (Choose recipe?) then (yes)
    :Add to meal plan;

    |Meal Plan Service|
    :Create meal plan;
    :Emit **MealPlanned** event;
  else (no)
    if (Ingredient spoiled?) then (yes)
      :Discard item;

      |Pantry Service|
      :Remove from pantry;

      |Leftovers Service|
      :Log as waste;
      :Update waste metrics;
    else (no)
    endif
  endif
else (no)
endif

stop

@enduml
