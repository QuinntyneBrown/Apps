@startuml RecipeManager System Architecture

!include <C4/C4_Container>

LAYOUT_WITH_LEGEND()

title System Architecture - Recipe Manager & Meal Planner

Person(user, "Family Member", "Uses app to manage recipes and plan meals")

System_Boundary(app, "Recipe Manager System") {
  Container(spa, "Web Application", "React, TypeScript", "Provides recipe and meal planning UI")
  Container(api, "API Gateway", ".NET 8, C#", "Handles HTTP requests, JWT authentication")

  Container_Boundary(services, "Backend Services") {
    Container(recipeService, "Recipe Service", "CQRS", "Manages recipes, ratings, favorites")
    Container(mealPlanService, "Meal Planning Service", "CQRS", "Handles meal calendar and planning")
    Container(groceryService, "Grocery Service", "CQRS", "Manages shopping lists")
    Container(pantryService, "Pantry Service", "CQRS", "Tracks inventory and expiration")
    Container(nutritionService, "Nutrition Service", "CQRS", "Calculates and tracks nutrition")
    Container(prepService, "Prep Scheduling Service", "CQRS", "Optimizes cooking workflows")
  }

  ContainerDb(db, "SQL Server Database", "SQL Server", "Stores recipes, meal plans, inventory")
  ContainerDb(eventStore, "Event Store", "SQL Server", "Domain events for audit and replay")
  ContainerQueue(messageQueue, "Message Queue", "RabbitMQ/Azure Service Bus", "Event distribution")
  Container(cache, "Cache", "Redis", "Caches frequently accessed data")
  Container(jobs, "Background Jobs", "Hangfire", "Scheduled tasks: expiration checks, summaries")
  Container(storage, "Blob Storage", "Azure Blob/S3", "Recipe photos")
  Container(realtime, "Real-time Hub", "SignalR", "Live updates for shared households")
}

System_Ext(usda, "USDA FoodData Central", "Nutritional database")
System_Ext(recipeParser, "Recipe Parser", "Extract recipes from URLs")
System_Ext(emailService, "Email Service", "SMTP/SendGrid", "Notifications and alerts")

Rel(user, spa, "Uses", "HTTPS")
Rel(spa, api, "API calls", "JSON/HTTPS")
Rel(spa, realtime, "WebSocket connection", "SignalR")

Rel(api, recipeService, "Routes requests")
Rel(api, mealPlanService, "Routes requests")
Rel(api, groceryService, "Routes requests")
Rel(api, pantryService, "Routes requests")
Rel(api, nutritionService, "Routes requests")
Rel(api, prepService, "Routes requests")

Rel(recipeService, db, "Reads/Writes", "EF Core")
Rel(mealPlanService, db, "Reads/Writes", "EF Core")
Rel(groceryService, db, "Reads/Writes", "EF Core")
Rel(pantryService, db, "Reads/Writes", "EF Core")
Rel(nutritionService, db, "Reads/Writes", "EF Core")
Rel(prepService, db, "Reads/Writes", "EF Core")

Rel(recipeService, eventStore, "Publishes events")
Rel(mealPlanService, eventStore, "Publishes events")
Rel(groceryService, eventStore, "Publishes events")
Rel(pantryService, eventStore, "Publishes events")

Rel(recipeService, messageQueue, "Publishes")
Rel(mealPlanService, messageQueue, "Subscribes/Publishes")
Rel(groceryService, messageQueue, "Subscribes")
Rel(pantryService, messageQueue, "Subscribes")
Rel(nutritionService, messageQueue, "Subscribes")

Rel(recipeService, cache, "Caches recipes")
Rel(recipeService, storage, "Stores/retrieves photos")
Rel(jobs, pantryService, "Triggers expiration checks")
Rel(jobs, emailService, "Sends notifications")
Rel(nutritionService, usda, "Queries nutritional data", "HTTPS")
Rel(recipeService, recipeParser, "Imports recipes", "HTTPS")

@enduml
