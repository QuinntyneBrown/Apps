<ng-container *ngIf="viewModel$ | async as vm">
  <div class="discover">
    <header class="discover__header">
      <h1 class="discover__title">Discover</h1>
      <p class="discover__subtitle">Personalized recommendations based on your viewing history</p>
    </header>

    <div class="discover__grid">
      @for (rec of vm.recommendations; track rec.recommendationId) {
        <mat-card class="discover__card">
          <div class="discover__card-poster">
            <span class="discover__card-icon">
              {{ rec.contentType === 'movie' ? 'ðŸŽ¬' : 'ðŸ“º' }}
            </span>
            <div class="discover__card-score">
              <span class="discover__card-score-value">{{ rec.matchScore }}%</span>
              <span class="discover__card-score-label">Match</span>
            </div>
          </div>

          <mat-card-content class="discover__card-content">
            <div class="discover__card-header">
              <h3 class="discover__card-title">{{ rec.title }}</h3>
              <span class="discover__card-source" [title]="rec.source">
                {{ getSourceIcon(rec.source) }}
              </span>
            </div>

            <p class="discover__card-meta">{{ rec.releaseYear }}</p>

            <div class="discover__card-genres">
              @for (genre of rec.genres; track genre) {
                <mat-chip class="discover__card-genre">{{ formatGenre(genre) }}</mat-chip>
              }
            </div>

            <p class="discover__card-reason">{{ rec.reason }}</p>
          </mat-card-content>

          <mat-card-actions class="discover__card-actions">
            <button
              mat-flat-button
              color="primary"
              (click)="onAddToWatchlist(rec)"
              class="discover__card-btn"
            >
              <mat-icon>add</mat-icon>
              Add to Watchlist
            </button>
            <button
              mat-stroked-button
              (click)="onDismiss(rec.recommendationId)"
              class="discover__card-btn"
            >
              <mat-icon>close</mat-icon>
              Dismiss
            </button>
          </mat-card-actions>
        </mat-card>
      } @empty {
        <div class="discover__empty">
          <p>No recommendations available. Start watching more content to get personalized suggestions!</p>
        </div>
      }
    </div>
  </div>
</ng-container>
