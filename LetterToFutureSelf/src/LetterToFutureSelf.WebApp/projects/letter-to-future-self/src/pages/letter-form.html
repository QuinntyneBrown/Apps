<div class="letter-form">
  <div class="letter-form__header">
    <h1 class="letter-form__title">{{ isEditMode ? 'Edit Letter' : 'Create New Letter' }}</h1>
    <p class="letter-form__subtitle">{{ isEditMode ? 'Update your letter details' : 'Write a letter to your future self' }}</p>
  </div>

  <mat-card class="letter-form__card">
    <mat-card-content>
      <form [formGroup]="letterForm" (ngSubmit)="onSubmit()" class="letter-form__form">
        <mat-form-field appearance="outline" class="letter-form__field">
          <mat-label>Subject</mat-label>
          <input matInput formControlName="subject" placeholder="Enter letter subject" maxlength="200">
          <mat-icon matPrefix>subject</mat-icon>
          <mat-error *ngIf="letterForm.get('subject')?.hasError('required')">
            Subject is required
          </mat-error>
          <mat-error *ngIf="letterForm.get('subject')?.hasError('maxlength')">
            Subject must be less than 200 characters
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="letter-form__field letter-form__field--full">
          <mat-label>Content</mat-label>
          <textarea
            matInput
            formControlName="content"
            placeholder="Write your letter here..."
            rows="15"
            maxlength="10000">
          </textarea>
          <mat-icon matPrefix>mail</mat-icon>
          <mat-hint align="end">{{ letterForm.get('content')?.value?.length || 0 }} / 10000</mat-hint>
          <mat-error *ngIf="letterForm.get('content')?.hasError('required')">
            Content is required
          </mat-error>
          <mat-error *ngIf="letterForm.get('content')?.hasError('maxlength')">
            Content must be less than 10000 characters
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="letter-form__field">
          <mat-label>Scheduled Delivery Date</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="scheduledDeliveryDate" placeholder="Select delivery date">
          <mat-icon matPrefix>event</mat-icon>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="letterForm.get('scheduledDeliveryDate')?.hasError('required')">
            Scheduled delivery date is required
          </mat-error>
        </mat-form-field>

        <div class="letter-form__actions">
          <button mat-raised-button type="button" (click)="onCancel()" [disabled]="loading$ | async">
            <mat-icon>cancel</mat-icon>
            Cancel
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!letterForm.valid || (loading$ | async)">
            <mat-spinner *ngIf="loading$ | async" diameter="20" class="letter-form__spinner"></mat-spinner>
            <mat-icon *ngIf="!(loading$ | async)">{{ isEditMode ? 'save' : 'send' }}</mat-icon>
            {{ isEditMode ? 'Update Letter' : 'Create Letter' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
