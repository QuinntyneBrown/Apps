<div class="crypto-holding-detail" *ngIf="cryptoHolding$ | async as holding">
  <div class="crypto-holding-detail__header">
    <button mat-icon-button routerLink="/crypto-holdings" class="crypto-holding-detail__back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 class="crypto-holding-detail__title">{{ holding.symbol }} - {{ holding.name }}</h1>
  </div>

  <div class="crypto-holding-detail__info">
    <mat-card class="crypto-holding-detail__info-card">
      <mat-card-header>
        <mat-card-title>Holding Information</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="crypto-holding-detail__info-grid">
          <div class="crypto-holding-detail__info-item">
            <span class="crypto-holding-detail__info-label">Quantity:</span>
            <span class="crypto-holding-detail__info-value">{{ holding.quantity }}</span>
          </div>
          <div class="crypto-holding-detail__info-item">
            <span class="crypto-holding-detail__info-label">Average Cost:</span>
            <span class="crypto-holding-detail__info-value">{{ holding.averageCost | currency }}</span>
          </div>
          <div class="crypto-holding-detail__info-item">
            <span class="crypto-holding-detail__info-label">Current Price:</span>
            <span class="crypto-holding-detail__info-value">{{ holding.currentPrice | currency }}</span>
          </div>
          <div class="crypto-holding-detail__info-item">
            <span class="crypto-holding-detail__info-label">Market Value:</span>
            <span class="crypto-holding-detail__info-value crypto-holding-detail__info-value--highlight">{{ holding.marketValue | currency }}</span>
          </div>
          <div class="crypto-holding-detail__info-item">
            <span class="crypto-holding-detail__info-label">Unrealized Gain/Loss:</span>
            <span class="crypto-holding-detail__info-value"
                  [class.crypto-holding-detail__gain]="holding.unrealizedGainLoss > 0"
                  [class.crypto-holding-detail__loss]="holding.unrealizedGainLoss < 0">
              {{ holding.unrealizedGainLoss | currency }}
            </span>
          </div>
          <div class="crypto-holding-detail__info-item">
            <span class="crypto-holding-detail__info-label">Last Price Update:</span>
            <span class="crypto-holding-detail__info-value">{{ holding.lastPriceUpdate | date:'short' }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card class="crypto-holding-detail__section">
    <mat-card-header>
      <mat-card-title>Tax Lots</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="(taxLots$ | async) || []" class="crypto-holding-detail__table">
        <ng-container matColumnDef="acquisitionDate">
          <th mat-header-cell *matHeaderCellDef>Acquisition Date</th>
          <td mat-cell *matCellDef="let taxLot">{{ taxLot.acquisitionDate | date }}</td>
        </ng-container>

        <ng-container matColumnDef="quantity">
          <th mat-header-cell *matHeaderCellDef>Quantity</th>
          <td mat-cell *matCellDef="let taxLot">{{ taxLot.quantity }}</td>
        </ng-container>

        <ng-container matColumnDef="costBasis">
          <th mat-header-cell *matHeaderCellDef>Cost Basis</th>
          <td mat-cell *matCellDef="let taxLot">{{ taxLot.costBasis | currency }}</td>
        </ng-container>

        <ng-container matColumnDef="isDisposed">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let taxLot">
            <span [class.crypto-holding-detail__status--disposed]="taxLot.isDisposed"
                  [class.crypto-holding-detail__status--active]="!taxLot.isDisposed"
                  class="crypto-holding-detail__status">
              {{ taxLot.isDisposed ? 'Disposed' : 'Active' }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="disposalDate">
          <th mat-header-cell *matHeaderCellDef>Disposal Date</th>
          <td mat-cell *matCellDef="let taxLot">{{ taxLot.disposalDate ? (taxLot.disposalDate | date) : 'N/A' }}</td>
        </ng-container>

        <ng-container matColumnDef="realizedGainLoss">
          <th mat-header-cell *matHeaderCellDef>Realized Gain/Loss</th>
          <td mat-cell *matCellDef="let taxLot">
            <span *ngIf="taxLot.realizedGainLoss !== null && taxLot.realizedGainLoss !== undefined"
                  [class.crypto-holding-detail__gain]="taxLot.realizedGainLoss > 0"
                  [class.crypto-holding-detail__loss]="taxLot.realizedGainLoss < 0">
              {{ taxLot.realizedGainLoss | currency }}
            </span>
            <span *ngIf="taxLot.realizedGainLoss === null || taxLot.realizedGainLoss === undefined">N/A</span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="taxLotsColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: taxLotsColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
