@startuml User Authentication Flow
title User Authentication Flow - JobSearchOrganizer

actor User
participant "Login Page" as Login
participant "Auth Service" as AuthService
participant "API Gateway" as API
participant "Auth Controller" as Controller
participant "User Repository" as Repo
participant "Database" as DB

User -> Login: Enter credentials
Login -> Login: Validate form fields

alt Valid Form
    Login -> AuthService: login(username, password)
    AuthService -> API: POST /api/auth/login
    API -> Controller: Authenticate request
    Controller -> Repo: FindByUsername(username)
    Repo -> DB: SELECT * FROM Users WHERE Username = @username
    DB --> Repo: User record
    Repo --> Controller: User entity

    Controller -> Controller: Verify password hash\n(PBKDF2 with salt)

    alt Valid Credentials
        Controller -> Controller: Generate JWT token\n(claims: sub, name, email, roles)
        Controller --> API: 200 OK + JWT token
        API --> AuthService: Token response
        AuthService -> AuthService: Store token in localStorage
        AuthService --> Login: Success
        Login -> User: Redirect to Dashboard
    else Invalid Credentials
        Controller --> API: 401 Unauthorized
        API --> AuthService: Error response
        AuthService --> Login: Auth failed
        Login -> User: Show error message
    end
else Invalid Form
    Login -> User: Show validation errors
end

@enduml
