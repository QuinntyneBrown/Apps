@startuml User Management Flow
title User Management Flow - JobSearchOrganizer

actor Admin
participant "User Management Page" as Page
participant "User Service" as Service
participant "API Gateway" as API
participant "Users Controller" as Controller
participant "IJobSearchOrganizerContext" as Context
participant "Database" as DB

== View Users ==
Admin -> Page: Navigate to /admin/users
Page -> Service: loadUsers()
Service -> API: GET /api/users
API -> Controller: [Authorize(Roles="Admin")]
Controller -> Context: Users.Include(Roles)
Context -> DB: SELECT u.*, r.* FROM Users u\nJOIN UserRoles ur ON u.Id = ur.UserId\nJOIN Roles r ON ur.RoleId = r.Id
DB --> Context: Users with roles
Context --> Controller: User entities
Controller --> API: 200 OK + UserDtos
API --> Service: Users list
Service --> Page: Display users table

== Create User ==
Admin -> Page: Click "Add User"
Page -> Page: Open create user modal
Admin -> Page: Enter username, email, password
Admin -> Page: Select roles
Admin -> Page: Click "Save"

Page -> Service: createUser(userData)
Service -> API: POST /api/users
API -> Controller: CreateUserCommand
Controller -> Controller: Validate uniqueness
Controller -> Controller: Hash password (PBKDF2 + salt)
Controller -> Context: Users.Add(user)
Context -> DB: INSERT INTO Users, UserRoles
DB --> Context: User created
Controller --> API: 201 Created
API --> Service: New user
Service --> Page: Refresh list

== Assign Role ==
Admin -> Page: Click user row
Page -> Page: Open user detail/role modal
Admin -> Page: Select role to add
Admin -> Page: Click "Add Role"

Page -> Service: addRoleToUser(userId, roleId)
Service -> API: POST /api/users/{id}/roles
API -> Controller: AddRoleCommand
Controller -> Context: UserRoles.Add(userRole)
Context -> DB: INSERT INTO UserRoles
DB --> Context: Success
Controller --> API: 200 OK
API --> Service: Updated user
Service --> Page: Refresh role display

@enduml
