<div class="goal-detail" *ngIf="goal">
  <div class="goal-detail__header">
    <button mat-icon-button (click)="goBack()" class="goal-detail__back">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 class="goal-detail__title">{{ goal.title }}</h1>
  </div>

  <div class="goal-detail__content">
    <div class="goal-detail__main">
      <mat-card class="goal-detail__info-card">
        <mat-card-content>
          <div class="goal-detail__meta-row">
            <mat-chip-set>
              <mat-chip>{{ categoryLabels[goal.category] }}</mat-chip>
              <mat-chip>{{ statusLabels[goal.status] }}</mat-chip>
              <mat-chip>{{ getPriorityLabel(goal.priority) }}</mat-chip>
              <mat-chip *ngIf="goal.isShared">
                <mat-icon>people</mat-icon>
                Shared
              </mat-chip>
            </mat-chip-set>
          </div>

          <p class="goal-detail__description">{{ goal.description }}</p>

          <div class="goal-detail__progress">
            <div class="goal-detail__progress-label">
              <span>Overall Progress</span>
              <span>{{ goal.completionPercentage }}%</span>
            </div>
            <mat-progress-bar
              mode="determinate"
              [value]="goal.completionPercentage"
              class="goal-detail__progress-bar">
            </mat-progress-bar>
          </div>

          <div class="goal-detail__dates">
            <div *ngIf="goal.targetDate" class="goal-detail__date-item">
              <mat-icon>event</mat-icon>
              <div>
                <div class="goal-detail__date-label">Target Date</div>
                <div class="goal-detail__date-value">{{ goal.targetDate | date:'mediumDate' }}</div>
              </div>
            </div>
            <div *ngIf="goal.completedDate" class="goal-detail__date-item">
              <mat-icon>check_circle</mat-icon>
              <div>
                <div class="goal-detail__date-label">Completed</div>
                <div class="goal-detail__date-value">{{ goal.completedDate | date:'mediumDate' }}</div>
              </div>
            </div>
            <div class="goal-detail__date-item">
              <mat-icon>schedule</mat-icon>
              <div>
                <div class="goal-detail__date-label">Created</div>
                <div class="goal-detail__date-value">{{ goal.createdAt | date:'mediumDate' }}</div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <div class="goal-detail__section">
        <div class="goal-detail__section-header">
          <h2 class="goal-detail__section-title">Milestones</h2>
          <button mat-raised-button color="primary" (click)="openCreateMilestoneDialog()">
            <mat-icon>add</mat-icon>
            Add Milestone
          </button>
        </div>

        <div class="goal-detail__milestones" *ngIf="milestones.length > 0">
          <app-milestone-card
            *ngFor="let milestone of milestones"
            [milestone]="milestone"
            (toggleComplete)="onToggleMilestoneComplete($event)"
            (delete)="onDeleteMilestone($event)">
          </app-milestone-card>
        </div>

        <div class="goal-detail__empty" *ngIf="milestones.length === 0">
          <p>No milestones yet. Break down your goal into smaller milestones!</p>
        </div>
      </div>

      <mat-divider></mat-divider>

      <div class="goal-detail__section">
        <div class="goal-detail__section-header">
          <h2 class="goal-detail__section-title">Progress Log</h2>
          <button mat-raised-button color="primary" (click)="openCreateProgressDialog()">
            <mat-icon>add</mat-icon>
            Log Progress
          </button>
        </div>

        <div class="goal-detail__progress-list" *ngIf="progresses.length > 0">
          <mat-card *ngFor="let progress of progresses" class="goal-detail__progress-card">
            <mat-card-content>
              <div class="goal-detail__progress-header">
                <div class="goal-detail__progress-date">
                  <mat-icon>event</mat-icon>
                  {{ progress.progressDate | date:'mediumDate' }}
                </div>
                <div class="goal-detail__progress-percentage">
                  {{ progress.completionPercentage }}%
                </div>
              </div>
              <p class="goal-detail__progress-notes">{{ progress.notes }}</p>
              <div class="goal-detail__progress-meta">
                <span *ngIf="progress.effortHours" class="goal-detail__progress-meta-item">
                  <mat-icon>schedule</mat-icon>
                  {{ progress.effortHours }} hours
                </span>
                <span *ngIf="progress.isSignificant" class="goal-detail__progress-meta-item goal-detail__progress-meta-item--significant">
                  <mat-icon>star</mat-icon>
                  Significant
                </span>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="goal-detail__empty" *ngIf="progresses.length === 0">
          <p>No progress logged yet. Start tracking your progress!</p>
        </div>
      </div>
    </div>
  </div>
</div>
