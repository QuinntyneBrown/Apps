<div class="page-container">
  <h1 class="page-title">Dashboard</h1>

  @if (viewModel$ | async; as vm) {
    <div class="dashboard">
      <section class="dashboard__stats">
        <mat-card class="dashboard__stat-card">
          <mat-card-content>
            <div class="dashboard__stat">
              <mat-icon>people</mat-icon>
              <div class="dashboard__stat-info">
                <span class="dashboard__stat-value">{{ vm.recipientCount }}</span>
                <span class="dashboard__stat-label">Recipients</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="dashboard__stat-card">
          <mat-card-content>
            <div class="dashboard__stat">
              <mat-icon>card_giftcard</mat-icon>
              <div class="dashboard__stat-info">
                <span class="dashboard__stat-value">{{ vm.giftIdeaCount }}</span>
                <span class="dashboard__stat-label">Gift Ideas</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="dashboard__stat-card">
          <mat-card-content>
            <div class="dashboard__stat">
              <mat-icon>shopping_cart</mat-icon>
              <div class="dashboard__stat-info">
                <span class="dashboard__stat-value">{{ vm.purchasedCount }}</span>
                <span class="dashboard__stat-label">Purchased</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="dashboard__stat-card dashboard__stat-card--budget">
          <mat-card-content>
            <div class="dashboard__stat">
              <mat-icon>attach_money</mat-icon>
              <div class="dashboard__stat-info">
                <span class="dashboard__stat-value">${{ vm.totalSpent.toFixed(0) }} / ${{ vm.totalBudget.toFixed(0) }}</span>
                <span class="dashboard__stat-label">Budget ({{ getBudgetPercentage(vm.totalSpent, vm.totalBudget) }}%)</span>
              </div>
            </div>
            <div class="dashboard__budget-bar">
              <div class="dashboard__budget-fill" [style.width.%]="getBudgetPercentage(vm.totalSpent, vm.totalBudget)"></div>
            </div>
          </mat-card-content>
        </mat-card>
      </section>

      <section class="dashboard__section">
        <div class="dashboard__section-header">
          <h2>Recent Gift Ideas</h2>
          <button mat-button color="primary" routerLink="/gift-ideas">View All</button>
        </div>

        @if (vm.recentIdeas.length > 0) {
          <div class="card-grid">
            @for (idea of vm.recentIdeas; track idea.giftIdeaId) {
              <app-gift-idea-card
                [giftIdea]="idea"
                (purchaseClick)="onPurchaseGiftIdea($event)"
                (editClick)="onEditGiftIdea($event)"
                (deleteClick)="onDeleteGiftIdea($event)">
              </app-gift-idea-card>
            }
          </div>
        } @else {
          <mat-card class="dashboard__empty-card">
            <mat-card-content>
              <mat-icon>card_giftcard</mat-icon>
              <p>No gift ideas yet. Add your first idea!</p>
              <button mat-raised-button color="primary" (click)="onAddGiftIdea()">
                <mat-icon>add</mat-icon>
                Add Gift Idea
              </button>
            </mat-card-content>
          </mat-card>
        }
      </section>

      <section class="dashboard__section">
        <div class="dashboard__section-header">
          <h2>Quick Actions</h2>
        </div>
        <div class="dashboard__actions">
          <button mat-raised-button color="primary" (click)="onAddGiftIdea()">
            <mat-icon>add</mat-icon>
            Add Gift Idea
          </button>
          <button mat-stroked-button routerLink="/recipients">
            <mat-icon>people</mat-icon>
            Manage Recipients
          </button>
          <button mat-stroked-button routerLink="/purchases">
            <mat-icon>shopping_cart</mat-icon>
            View Purchases
          </button>
        </div>
      </section>
    </div>
  }
</div>
