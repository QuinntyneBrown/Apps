<div class="plan-detail" *ngIf="plan$ | async as plan">
  <div class="plan-detail__header">
    <button mat-icon-button routerLink="/plans" class="plan-detail__back">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 class="plan-detail__title">{{ plan.name }}</h1>
    <span class="plan-detail__spacer"></span>
    <button mat-raised-button color="warn" (click)="deletePlan()">
      <mat-icon>delete</mat-icon>
      Delete Plan
    </button>
  </div>

  <mat-card class="plan-detail__info">
    <mat-card-header>
      <mat-card-title>Plan Information</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="plan-detail__info-grid">
        <div class="plan-detail__info-item">
          <span class="plan-detail__info-label">State:</span>
          <span class="plan-detail__info-value">{{ plan.state }}</span>
        </div>
        <div class="plan-detail__info-item">
          <span class="plan-detail__info-label">Account Number:</span>
          <span class="plan-detail__info-value">{{ plan.accountNumber || 'N/A' }}</span>
        </div>
        <div class="plan-detail__info-item">
          <span class="plan-detail__info-label">Current Balance:</span>
          <span class="plan-detail__info-value">{{ plan.currentBalance | currency }}</span>
        </div>
        <div class="plan-detail__info-item">
          <span class="plan-detail__info-label">Opened Date:</span>
          <span class="plan-detail__info-value">{{ plan.openedDate | date }}</span>
        </div>
        <div class="plan-detail__info-item">
          <span class="plan-detail__info-label">Administrator:</span>
          <span class="plan-detail__info-value">{{ plan.administrator || 'N/A' }}</span>
        </div>
        <div class="plan-detail__info-item">
          <span class="plan-detail__info-label">Status:</span>
          <span class="plan-detail__info-value">{{ plan.isActive ? 'Active' : 'Inactive' }}</span>
        </div>
      </div>
      <div class="plan-detail__info-item" *ngIf="plan.notes">
        <span class="plan-detail__info-label">Notes:</span>
        <span class="plan-detail__info-value">{{ plan.notes }}</span>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-tab-group class="plan-detail__tabs">
    <mat-tab label="Beneficiaries">
      <mat-list>
        <mat-list-item *ngFor="let beneficiary of beneficiaries$ | async">
          <span matListItemTitle>{{ beneficiary.firstName }} {{ beneficiary.lastName }}</span>
          <span matListItemLine>Age: {{ beneficiary.age }}, Years Until College: {{ beneficiary.yearsUntilCollege || 'N/A' }}</span>
          <mat-icon matListItemIcon>person</mat-icon>
        </mat-list-item>
        <mat-list-item *ngIf="(beneficiaries$ | async)?.length === 0">
          <span matListItemTitle>No beneficiaries found</span>
        </mat-list-item>
      </mat-list>
    </mat-tab>

    <mat-tab label="Contributions">
      <mat-list>
        <mat-list-item *ngFor="let contribution of contributions$ | async">
          <span matListItemTitle>{{ contribution.amount | currency }} - {{ contribution.contributionDate | date }}</span>
          <span matListItemLine>Contributor: {{ contribution.contributor || 'N/A' }}</span>
          <mat-icon matListItemIcon>payment</mat-icon>
        </mat-list-item>
        <mat-list-item *ngIf="(contributions$ | async)?.length === 0">
          <span matListItemTitle>No contributions found</span>
        </mat-list-item>
      </mat-list>
    </mat-tab>

    <mat-tab label="Projections">
      <mat-list>
        <mat-list-item *ngFor="let projection of projections$ | async">
          <span matListItemTitle>{{ projection.name }}</span>
          <span matListItemLine>Projected Balance: {{ projection.projectedBalance | currency }}, Target: {{ projection.targetGoal | currency }}</span>
          <mat-icon matListItemIcon>trending_up</mat-icon>
        </mat-list-item>
        <mat-list-item *ngIf="(projections$ | async)?.length === 0">
          <span matListItemTitle>No projections found</span>
        </mat-list-item>
      </mat-list>
    </mat-tab>
  </mat-tab-group>
</div>
